---
name: snsweb
version: 1.0.0
description: íŒŒì¼ ë° ì‚¬ì§„ ì—…ë¡œë“œ ê°œë°œ ê°€ì´ë“œ ë¬¸ì„œì˜ SED ì‚¬ì–‘
author: JaeHo Song
email: thruthesky@gmail.com
homepage: https://github.com/thruthesky/
funding: ""
license: SED Specification License v1.0
dependencies: []
"í”„ë¡œì íŠ¸ ì´ë¦„": snsweb
---

## Overview
- ì´ ë¬¸ì„œëŠ” "íŒŒì¼ ë° ì‚¬ì§„ ì—…ë¡œë“œ ê°œë°œ ê°€ì´ë“œ"ì— ëŒ€í•œ ì„¸ë¶€ ì‚¬ì–‘ì„ ì •ë¦¬í•˜ë©°, ê¸°ì¡´ ë‚´ìš©ì„ ê·¸ëŒ€ë¡œ ìœ ì§€í•œ ì±„ SED êµ¬ì¡°ì— ë§ì¶° ì œê³µí•©ë‹ˆë‹¤.

## Requirements
- ë¬¸ì„œ ì „ë°˜ì— ê±¸ì³ ì†Œê°œë˜ëŠ” ì§€ì¹¨ê³¼ ì°¸ê³  ì‚¬í•­ì„ ëª¨ë‘ ìˆ™ì§€í•´ì•¼ í•˜ë©°, ë³„ë„ì˜ ì¶”ê°€ ì„ í–‰ ì¡°ê±´ì€ ì›ë¬¸ ê° ì ˆì—ì„œ ì œì‹œë˜ëŠ” ë‚´ìš©ì„ ë”°ë¦…ë‹ˆë‹¤.

## Workflow
1. ì•„ë˜ `## Detail Items` ì ˆì— í¬í•¨ëœ ì›ë¬¸ ëª©ì°¨ë¥¼ ê²€í† í•©ë‹ˆë‹¤.
2. í•„ìš”í•œ ê²½ìš° ì›ë¬¸ì˜ ê° ì ˆì„ ìˆœì„œëŒ€ë¡œ ì½ìœ¼ë©° í”„ë¡œì íŠ¸ ì‘ì—… íë¦„ì— ë°˜ì˜í•©ë‹ˆë‹¤.
3. ë¬¸ì„œì— ëª…ì‹œëœ ëª¨ë“  ì§€ì¹¨ì„ í™•ì¸í•œ ë’¤ ì‹¤ì œ ê°œë°œ ë‹¨ê³„ì— ì ìš©í•©ë‹ˆë‹¤.

## Detail Items
- ì´í•˜ì—ëŠ” ê¸°ì¡´ ë¬¸ì„œì˜ ëª¨ë“  ë‚´ìš©ì„ ì›í˜• ê·¸ëŒ€ë¡œ í¬í•¨í•˜ì—¬ ì°¸ì¡°í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.

# íŒŒì¼ ë° ì‚¬ì§„ ì—…ë¡œë“œ ê°œë°œ ê°€ì´ë“œ

ë³¸ ë¬¸ì„œëŠ” SNS ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ Firebase Cloud Storageë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ ë° ì‚¬ì§„ ì—…ë¡œë“œ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ê°€ì´ë“œì…ë‹ˆë‹¤. íŒŒì¼ ì—…ë¡œë“œë¥¼ êµ¬í˜„í•  ë•Œì—ëŠ” ë°˜ë“œì‹œ ì•„ë˜ì˜ ê·œì¹™ê³¼ ì˜ˆì œë¥¼ ë”°ë¼ì•¼ í•©ë‹ˆë‹¤.

**ì°¸ê³  ìë£Œ**:
- [Firebase Cloud Storage ê³µì‹ ë¬¸ì„œ](https://firebase.google.com/docs/storage/web/start)
- [ì—…ë¡œë“œ íŒŒì¼ ê°€ì´ë“œ](https://firebase.google.com/docs/storage/web/upload-files)
- [ì‚­ì œ íŒŒì¼ ê°€ì´ë“œ](https://firebase.google.com/docs/storage/web/delete-files)




# ê°œìš”

SNS ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ì‚¬ìš©ìê°€ ì‚¬ì§„ ë° íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì´ í•„ìš”í•©ë‹ˆë‹¤.

- **íŒŒì¼ ì—…ë¡œë“œ**: Firebase Cloud Storageë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„
- **URL ì €ì¥**: ì—…ë¡œë“œëœ íŒŒì¼ì˜ URL ì£¼ì†ŒëŠ” Firebase Realtime Databaseì— ì €ì¥
- **ë³´ì•ˆ**: Firebase ë³´ì•ˆ ê·œì¹™ì„ ì¤€ìˆ˜í•˜ì—¬ ì‚¬ìš©ìê°€ ìì‹ ì˜ íŒŒì¼ë§Œ ì—…ë¡œë“œ ë° ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì œì–´

## ìš”êµ¬ì‚¬í•­

- **Firebase í”„ë¡œì íŠ¸**: Blaze(ì¢…ëŸ‰ì œ) ì´ìƒì˜ ìš”ê¸ˆì œ í•„ìš”
- **ì €ì¥ì†Œ ë²„í‚·**: Firebase Consoleì—ì„œ Cloud Storage ë²„í‚· ìƒì„±
- **SDK ì´ˆê¸°í™”**: Firebase Web SDK v9 ì´ìƒ


# Firebase ì´ˆê¸°í™” ë° ì„¤ì •

## 1. SDK ì´ˆê¸°í™”

Firebase Storageë¥¼ ì‚¬ìš©í•˜ê¸° ì „ì— ë¨¼ì € Firebase Appì„ ì´ˆê¸°í™”í•˜ê³  Storage ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.

```javascript
import { initializeApp } from 'firebase/app';
import { getStorage } from 'firebase/storage';
import { firebaseConfig } from '../../config/firebase.web-config';

// Firebase ì•± ì´ˆê¸°í™”
const app = initializeApp(firebaseConfig);

// Firebase Storage ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
export const storage = getStorage(app);
```

**ì°¸ê³ **: `firebaseConfig`ì—ëŠ” ë°˜ë“œì‹œ `storageBucket` í•„ë“œê°€ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

```javascript
// firebaseConfig ì˜ˆì‹œ
const firebaseConfig = {
  apiKey: "...",
  authDomain: "...",
  projectId: "...",
  storageBucket: "my-project.firebasestorage.app",  // í•„ìˆ˜
  // ...
};
```

---

# ì €ì¥ì†Œ ë ˆí¼ëŸ°ìŠ¤ ìƒì„±

## ë ˆí¼ëŸ°ìŠ¤ ìƒì„± ë°©ë²•

Firebase Storageì˜ íŒŒì¼ì„ ì°¸ì¡°í•˜ë ¤ë©´ `ref()` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë ˆí¼ëŸ°ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

```javascript
import { ref } from 'firebase/storage';

// 1. ë£¨íŠ¸ ë ˆí¼ëŸ°ìŠ¤ (ë²„í‚·ì˜ ìµœìƒìœ„)
const storageRef = ref(storage);

// 2. ê²½ë¡œë¥¼ ì§€ì •í•˜ì—¬ ìì‹ ë ˆí¼ëŸ°ìŠ¤ ìƒì„±
const profileRef = ref(storage, 'users/user_001/profile.jpg');
const folderRef = ref(storage, 'users/user_001/');
```

## ê³„ì¸µ êµ¬ì¡° íƒìƒ‰

ë ˆí¼ëŸ°ìŠ¤ì˜ ìƒìœ„ ê²½ë¡œë‚˜ ë£¨íŠ¸ë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```javascript
const profileRef = ref(storage, 'users/user_001/profile.jpg');

// ìƒìœ„ í´ë”ë¡œ ì´ë™
const userFolderRef = profileRef.parent;  // 'users/user_001/'

// ë£¨íŠ¸ë¡œ ì´ë™
const rootRef = profileRef.root;  // ë²„í‚·ì˜ ìµœìƒìœ„
```

## ë ˆí¼ëŸ°ìŠ¤ ì •ë³´ í™•ì¸

```javascript
const profileRef = ref(storage, 'users/user_001/profile.jpg');

console.log(profileRef.fullPath);  // 'users/user_001/profile.jpg'
console.log(profileRef.name);       // 'profile.jpg'
console.log(profileRef.bucket);     // 'my-project.firebasestorage.app'
```

---

# íŒŒì¼ ì—…ë¡œë“œ êµ¬í˜„

## íŒŒì¼ ì—…ë¡œë“œ ì œí•œ

### í—ˆìš©ë˜ëŠ” íŒŒì¼ íƒ€ì… ë° ìš©ëŸ‰

ë³¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ íŒŒì¼ ì—…ë¡œë“œ ì œí•œì„ ì ìš©í•©ë‹ˆë‹¤:

#### ì´ë¯¸ì§€ íŒŒì¼
- **í™•ì¥ì**: jpg, jpeg, png, gif, webp, bmp, svg
- **MIME íƒ€ì…**: image/jpeg, image/png, image/gif, image/webp, image/bmp, image/svg+xml
- **ìµœëŒ€ ìš©ëŸ‰**: 10MB

#### ë™ì˜ìƒ íŒŒì¼
- **í™•ì¥ì**: mp4 (mp4ë§Œ í—ˆìš©)
- **MIME íƒ€ì…**: video/mp4
- **ìµœëŒ€ ìš©ëŸ‰**: 50MB

#### ë¬¸ì„œ/ì••ì¶• íŒŒì¼
- **í™•ì¥ì**: zip, pdf, txt, doc, docx, ppt, pptx, csv, xls, xlsx, rar
- **MIME íƒ€ì…**:
  - application/zip
  - application/pdf
  - text/plain
  - application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document
  - application/vnd.ms-powerpoint, application/vnd.openxmlformats-officedocument.presentationml.presentation
  - text/csv
  - application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
  - application/x-rar-compressed, application/vnd.rar
- **ìµœëŒ€ ìš©ëŸ‰**: 15MB

### ê²€ì¦ ìœ„ì¹˜

íŒŒì¼ ì—…ë¡œë“œ ì œí•œì€ ë‘ ê³³ì—ì„œ ê²€ì¦ë©ë‹ˆë‹¤:

1. **í´ë¼ì´ì–¸íŠ¸ ì¸¡ (Svelte)**: `src/lib/services/fileValidation.ts`
   - ì‚¬ìš©ìì—ê²Œ ì¦‰ê°ì ì¸ í”¼ë“œë°± ì œê³µ
   - ë¶ˆí•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ ë°©ì§€

2. **ì„œë²„ ì¸¡ (Firebase Storage Rules)**: `storage.rules`
   - ë³´ì•ˆ ê°•í™” (í´ë¼ì´ì–¸íŠ¸ ìš°íšŒ ë°©ì§€)
   - ìµœì¢… ê²€ì¦

---

## ë³´ì•ˆ ê·œì¹™ ì„¤ì •

ì•„ë˜ì™€ ê°™ì´ Firebase Storage ë³´ì•ˆ ê·œì¹™ì´ ì„¤ì •ë˜ì–´ì ¸ ìˆìŠµë‹ˆë‹¤.
- `/users/{userId}/` ê²½ë¡œì— ì—…ë¡œë“œëœ íŒŒì¼ì€ í•´ë‹¹ ì‚¬ìš©ìë§Œ ì“°ê¸° ê¶Œí•œì´ ìˆìœ¼ë©°, ëª¨ë“  ì¸ì¦ëœ ì‚¬ìš©ìê°€ ì½ê¸° ê¶Œí•œì„ ê°€ì§‘ë‹ˆë‹¤.
- íŒŒì¼ íƒ€ì… ë° ìš©ëŸ‰ ì œí•œì´ ì„œë²„ ì¸¡ì—ì„œë„ ê°•ì œë©ë‹ˆë‹¤.
- ì´ëŠ” ì‚¬ìš©ìê°€ ìì‹ ì˜ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³ , ë‹¤ë¥¸ ì‚¬ìš©ìëŠ” í•´ë‹¹ íŒŒì¼ì„ ì½ì„ ìˆ˜ ìˆë„ë¡ í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.
- ë”°ë¼ì„œ, íŒŒì¼ ì—…ë¡œë“œ ì‹œì—ëŠ” ë°˜ë“œì‹œ ì‚¬ìš©ìì˜ UIDë¥¼ í¬í•¨í•œ ê²½ë¡œì— ì—…ë¡œë“œí•´ì•¼ í•©ë‹ˆë‹¤.

### Firebase Storage ë³´ì•ˆ ê·œì¹™

**íŒŒì¼ ìœ„ì¹˜**: `storage.rules`

```
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    /**
     * ì‚¬ìš©ìë³„ íŒŒì¼ ì—…ë¡œë“œ ê·œì¹™
     * ê²½ë¡œ: /users/{userId}/{category}/{filename}
     */
    match /users/{userId}/{category}/{filename} {
      /**
       * ì½ê¸° ê¶Œí•œ: ëª¨ë“  ì¸ì¦ëœ ì‚¬ìš©ì
       */
      allow read: if request.auth != null;

      /**
       * ì“°ê¸° ê¶Œí•œ: ë³¸ì¸ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥ + íŒŒì¼ ê²€ì¦
       */
      allow write: if request.auth != null
                   && request.auth.uid == userId
                   && isValidFile();

      /**
       * ì‚­ì œ ê¶Œí•œ: ë³¸ì¸ë§Œ ì‚­ì œ ê°€ëŠ¥
       */
      allow delete: if request.auth != null
                    && request.auth.uid == userId;

      /**
       * íŒŒì¼ ê²€ì¦ í•¨ìˆ˜
       */
      function isValidFile() {
        let fileSize = request.resource.size;
        let contentType = request.resource.contentType;

        // ì´ë¯¸ì§€ íŒŒì¼ ê²€ì¦ (ìµœëŒ€ 10MB)
        let isImage = contentType.matches('image/jpeg')
                   || contentType.matches('image/png')
                   || contentType.matches('image/gif')
                   || contentType.matches('image/webp')
                   || contentType.matches('image/bmp')
                   || contentType.matches('image/svg\\+xml');
        let isValidImage = isImage && fileSize <= 10 * 1024 * 1024;

        // ë™ì˜ìƒ íŒŒì¼ ê²€ì¦ (mp4ë§Œ, ìµœëŒ€ 50MB)
        let isVideo = contentType.matches('video/mp4');
        let isValidVideo = isVideo && fileSize <= 50 * 1024 * 1024;

        // ë¬¸ì„œ/ì••ì¶• íŒŒì¼ ê²€ì¦ (ìµœëŒ€ 15MB)
        let isDocument = contentType.matches('application/zip')
                      || contentType.matches('application/pdf')
                      || contentType.matches('text/plain')
                      || contentType.matches('application/msword')
                      || contentType.matches('application/vnd.openxmlformats-officedocument.wordprocessingml.document')
                      || contentType.matches('application/vnd.ms-powerpoint')
                      || contentType.matches('application/vnd.openxmlformats-officedocument.presentationml.presentation')
                      || contentType.matches('text/csv')
                      || contentType.matches('application/vnd.ms-excel')
                      || contentType.matches('application/vnd.openxmlformats-officedocument.spreadsheetml.sheet')
                      || contentType.matches('application/x-rar-compressed')
                      || contentType.matches('application/vnd.rar');
        let isValidDocument = isDocument && fileSize <= 15 * 1024 * 1024;

        return isValidImage || isValidVideo || isValidDocument;
      }
    }

    /**
     * ê¸°ë³¸ ê·œì¹™: ë‹¤ë¥¸ ëª¨ë“  ê²½ë¡œëŠ” ê±°ë¶€
     */
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
```

**ì£¼ìš” ë³€ê²½ ì‚¬í•­**:
- âœ… íŒŒì¼ íƒ€ì…ë³„ë¡œ ìƒì„¸í•œ MIME íƒ€ì… ê²€ì¦
- âœ… íŒŒì¼ íƒ€ì…ë³„ ìš©ëŸ‰ ì œí•œ (ì´ë¯¸ì§€ 10MB, ë™ì˜ìƒ 50MB, ë¬¸ì„œ 15MB)
- âœ… ì¸ì¦ëœ ì‚¬ìš©ìë§Œ íŒŒì¼ ì½ê¸° ê°€ëŠ¥
- âœ… ë³¸ì¸ë§Œ ìì‹ ì˜ íŒŒì¼ì„ ì—…ë¡œë“œ/ì‚­ì œ ê°€ëŠ¥

---

## íŒŒì¼ ì—…ë¡œë“œ ë°©ë²•

### 1. ë©”ëª¨ë¦¬ì—ì„œ íŒŒì¼ ì—…ë¡œë“œ (uploadBytes)

JavaScript `File` ë˜ëŠ” `Blob` ê°ì²´ë¥¼ ì§ì ‘ ì—…ë¡œë“œí•©ë‹ˆë‹¤.

```javascript
import { uploadBytes } from 'firebase/storage';

async function uploadProfilePhoto(userId, file) {
  // ì €ì¥ì†Œ ê²½ë¡œ ìƒì„±
  const photoRef = ref(storage, `users/${userId}/profile/photo.jpg`);

  try {
    // íŒŒì¼ ì—…ë¡œë“œ
    const snapshot = await uploadBytes(photoRef, file);
    console.log('íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ:', snapshot.metadata.name);
    return snapshot;
  } catch (error) {
    console.error('ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
    throw error;
  }
}
```

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤**: HTML `<input type="file">` ìš”ì†Œì—ì„œ ì„ íƒí•œ íŒŒì¼ì„ ì§ì ‘ ì—…ë¡œë“œí•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

### 2. ë¬¸ìì—´ë¡œ ì—…ë¡œë“œ (uploadString)

Base64, Base64url, Data URL í˜•ì‹ì˜ ë¬¸ìì—´ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤.

```javascript
import { uploadString } from 'firebase/storage';

async function uploadFromBase64(userId, base64String) {
  const photoRef = ref(storage, `users/${userId}/profile/photo.jpg`);

  try {
    // Base64 ë¬¸ìì—´ì„ íŒŒì¼ë¡œ ì—…ë¡œë“œ
    const snapshot = await uploadString(
      photoRef,
      base64String,
      'base64',
      { contentType: 'image/jpeg' }
    );
    console.log('íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ:', snapshot.metadata.name);
    return snapshot;
  } catch (error) {
    console.error('ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
    throw error;
  }
}
```

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤**: Canvasì—ì„œ ìƒì„±í•œ ì´ë¯¸ì§€ë‚˜ Base64ë¡œ ì¸ì½”ë”©ëœ ë°ì´í„°ë¥¼ ì—…ë¡œë“œí•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

### 3. ì§„í–‰ ìƒí™©ì„ ì¶”ì í•˜ë©´ì„œ ì—…ë¡œë“œ (uploadBytesResumable)

ëŒ€ìš©ëŸ‰ íŒŒì¼ ì—…ë¡œë“œ ì‹œ ì§„í–‰ ìƒí™©ì„ ëª¨ë‹ˆí„°ë§í•˜ê³  ì¼ì‹œ ì •ì§€/ì¬ê°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```javascript
import { uploadBytesResumable } from 'firebase/storage';

async function uploadWithProgress(userId, file, onProgress) {
  const photoRef = ref(storage, `users/${userId}/profile/${file.name}`);

  // ì—…ë¡œë“œ ì‘ì—… ìƒì„±
  const uploadTask = uploadBytesResumable(photoRef, file);

  return new Promise((resolve, reject) => {
    // ì—…ë¡œë“œ ìƒíƒœ ë³€í™” ê°ì‹œ
    uploadTask.on(
      'state_changed',
      (snapshot) => {
        // ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
        console.log(`ì§„í–‰ ìƒí™©: ${progress.toFixed(2)}%`);

        // ìƒíƒœ í™•ì¸
        const state = snapshot.state;
        if (state === 'running') {
          console.log('ì—…ë¡œë“œ ì¤‘...');
        } else if (state === 'paused') {
          console.log('ì—…ë¡œë“œ ì¼ì‹œ ì •ì§€ë¨');
        }

        // ì½œë°± í•¨ìˆ˜ë¡œ ì§„í–‰ ìƒí™© ì „ë‹¬
        onProgress?.(progress);
      },
      (error) => {
        // ì—…ë¡œë“œ ì‹¤íŒ¨
        console.error('ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
        reject(error);
      },
      () => {
        // ì—…ë¡œë“œ ì™„ë£Œ
        console.log('ì—…ë¡œë“œ ì„±ê³µ!');
        resolve(uploadTask.snapshot);
      }
    );
  });
}

// ì—…ë¡œë“œ ì œì–´ (ì¼ì‹œ ì •ì§€/ì¬ê°œ/ì·¨ì†Œ)
function controlUpload(uploadTask) {
  // ì¼ì‹œ ì •ì§€
  uploadTask.pause();

  // ì¬ê°œ
  uploadTask.resume();

  // ì·¨ì†Œ
  uploadTask.cancel();
}
```

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤**:
- ëŒ€ìš©ëŸ‰ íŒŒì¼ ì—…ë¡œë“œ ì‹œ ì§„í–‰ ìƒí™© í‘œì‹œ
- ì‚¬ìš©ìê°€ ì—…ë¡œë“œë¥¼ ì¼ì‹œ ì •ì§€/ì¬ê°œí•  ìˆ˜ ìˆì–´ì•¼ í•  ë•Œ
- ëŠë¦° ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì—ì„œ ì—…ë¡œë“œí•  ë•Œ

---

## íŒŒì¼ ë©”íƒ€ë°ì´í„° ì„¤ì •

íŒŒì¼ ì—…ë¡œë“œ ì‹œ MIME íƒ€ì… ë“±ì˜ ë©”íƒ€ë°ì´í„°ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```javascript
import { uploadBytes } from 'firebase/storage';

async function uploadWithMetadata(userId, file) {
  const photoRef = ref(storage, `users/${userId}/profile/photo.jpg`);

  // ë©”íƒ€ë°ì´í„° ê°ì²´ ìƒì„±
  const metadata = {
    contentType: 'image/jpeg',  // MIME íƒ€ì…
    customMetadata: {
      uploadedBy: userId,
      uploadedAt: new Date().toISOString()
    }
  };

  try {
    const snapshot = await uploadBytes(photoRef, file, metadata);
    console.log('íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ:',  {
      name: snapshot.metadata.name,
      size: snapshot.metadata.size,
      contentType: snapshot.metadata.contentType
    });
    return snapshot;
  } catch (error) {
    console.error('ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
    throw error;
  }
}
```

**ì°¸ê³ **: MIME íƒ€ì…ì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ Firebaseê°€ íŒŒì¼ í™•ì¥ìë¡œ ìë™ ê°ì§€í•©ë‹ˆë‹¤.

---

# ë‹¤ìš´ë¡œë“œ URL íšë“

ì—…ë¡œë“œëœ íŒŒì¼ì˜ ë‹¤ìš´ë¡œë“œ URLì„ íšë“í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•©ë‹ˆë‹¤.

```javascript
import { getDownloadURL } from 'firebase/storage';

async function uploadProfilePhotoAndGetURL(userId, file) {
  const photoRef = ref(storage, `users/${userId}/profile/photo.jpg`);

  try {
    // 1. íŒŒì¼ ì—…ë¡œë“œ
    const snapshot = await uploadBytes(photoRef, file);

    // 2. ë‹¤ìš´ë¡œë“œ URL íšë“
    const downloadURL = await getDownloadURL(snapshot.ref);
    console.log('ë‹¤ìš´ë¡œë“œ URL:', downloadURL);

    // 3. ë°ì´í„°ë² ì´ìŠ¤ì— URL ì €ì¥ (Realtime Database)
    await updateProfile({
      photoURL: downloadURL
    });

    return downloadURL;
  } catch (error) {
    console.error('ì—…ë¡œë“œ/URL íšë“ ì‹¤íŒ¨:', error);
    throw error;
  }
}
```

**ì¤‘ìš”**: ë‹¤ìš´ë¡œë“œ URLì€ ìˆ˜ì‹œë¡œ ë³€ê²½ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, íŒŒì¼ì„ ì°¸ì¡°í•  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ URLì„ íšë“í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì¼ë°˜ì ìœ¼ë¡œëŠ” `getDownloadURL`ë¡œ íšë“í•œ URLì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ê³  ì¬ì‚¬ìš©í•©ë‹ˆë‹¤.

---

# íŒŒì¼ ì‚­ì œ

ë” ì´ìƒ í•„ìš”í•˜ì§€ ì•Šì€ íŒŒì¼ì„ Storageì—ì„œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```javascript
import { deleteObject } from 'firebase/storage';

async function deleteProfilePhoto(userId) {
  const photoRef = ref(storage, `users/${userId}/profile/photo.jpg`);

  try {
    // íŒŒì¼ ì‚­ì œ
    await deleteObject(photoRef);
    console.log('íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');

    // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œë„ URL ì‚­ì œ
    await updateProfile({
      photoURL: null
    });

    return true;
  } catch (error) {
    console.error('íŒŒì¼ ì‚­ì œ ì‹¤íŒ¨:', error);
    throw error;
  }
}
```

## ì‚­ì œ ì‹œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì˜¤ë¥˜

| ì˜¤ë¥˜ | ì›ì¸ | í•´ê²° ë°©ë²• |
|-----|------|---------|
| `storage/object-not-found` | íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŒ | íŒŒì¼ ê²½ë¡œ í™•ì¸ |
| `storage/unauthorized` | ê¶Œí•œ ë¶€ì¡± (ë‹¤ë¥¸ ì‚¬ìš©ìì˜ íŒŒì¼) | ë³´ì•ˆ ê·œì¹™ í™•ì¸, ìì‹ ì˜ íŒŒì¼ë§Œ ì‚­ì œ |
| `storage/retry-limit-exceeded` | ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ | ì¬ì‹œë„ ë˜ëŠ” ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ |

---

# ì—ëŸ¬ ì²˜ë¦¬

## ì¼ë°˜ì ì¸ ì˜¤ë¥˜ ìƒí™© ë° ì²˜ë¦¬ ë°©ë²•

```javascript
import { uploadBytes } from 'firebase/storage';

async function uploadWithErrorHandling(userId, file) {
  const photoRef = ref(storage, `users/${userId}/profile/${file.name}`);

  try {
    // íŒŒì¼ í¬ê¸° ìœ íš¨ì„± ê²€ì‚¬ (í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ)
    const MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB
    if (file.size > MAX_FILE_SIZE) {
      throw new Error('íŒŒì¼ í¬ê¸°ê°€ 5MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤');
    }

    // íŒŒì¼ íƒ€ì… ìœ íš¨ì„± ê²€ì‚¬
    const ALLOWED_TYPES = ['image/jpeg', 'image/png', 'image/webp'];
    if (!ALLOWED_TYPES.includes(file.type)) {
      throw new Error('ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤ (JPEG, PNG, WebPë§Œ ê°€ëŠ¥)');
    }

    // íŒŒì¼ ì—…ë¡œë“œ
    const snapshot = await uploadBytes(photoRef, file);
    console.log('ì—…ë¡œë“œ ì„±ê³µ:', snapshot.metadata.name);
    return snapshot;

  } catch (error) {
    // Firebase ì˜¤ë¥˜ ì²˜ë¦¬
    if (error.code) {
      switch (error.code) {
        case 'storage/unauthorized':
          console.error('ê¶Œí•œ ì˜¤ë¥˜: íŒŒì¼ì„ ì—…ë¡œë“œí•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤');
          break;
        case 'storage/unknown':
          console.error('ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜:', error.message);
          break;
        case 'storage/retry-limit-exceeded':
          console.error('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”');
          break;
        default:
          console.error('ì—…ë¡œë“œ ì˜¤ë¥˜:', error.code, error.message);
      }
    } else {
      // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ìœ íš¨ì„± ê²€ì‚¬ ì˜¤ë¥˜
      console.error('ì…ë ¥ ì˜¤ë¥˜:', error.message);
    }
    throw error;
  }
}
```

## ê¶Œì¥ ì‚¬í•­

1. **íŒŒì¼ ìœ íš¨ì„± ê²€ì‚¬ (í´ë¼ì´ì–¸íŠ¸)**
   - íŒŒì¼ í¬ê¸° í™•ì¸ (ê¶Œì¥: 5MB ì´í•˜)
   - íŒŒì¼ íƒ€ì… í™•ì¸ (MIME íƒ€ì…)
   - ì‚¬ìš©ìì—ê²Œ ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ

2. **ì—…ë¡œë“œ ì§„í–‰ ìƒí™© í‘œì‹œ**
   - `uploadBytesResumable()` ì‚¬ìš©
   - ì§„í–‰ ë°”ë‚˜ ë°±ë¶„ìœ¨ í‘œì‹œ
   - ë„¤íŠ¸ì›Œí¬ê°€ ëŠë¦° ê²½ìš° íŠ¹íˆ ì¤‘ìš”

3. **ì—…ë¡œë“œ ì‹¤íŒ¨ ì¬ì‹œë„**
   ```javascript
   async function uploadWithRetry(userId, file, maxRetries = 3) {
     for (let i = 0; i < maxRetries; i++) {
       try {
         return await uploadProfilePhoto(userId, file);
       } catch (error) {
         if (i < maxRetries - 1) {
           console.log(`ì¬ì‹œë„ ${i + 1}/${maxRetries - 1}`);
           await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
         } else {
           throw error;
         }
       }
     }
   }
   ```

4. **ë°ì´í„°ë² ì´ìŠ¤ ì¼ê´€ì„± ìœ ì§€**
   - íŒŒì¼ ì—…ë¡œë“œ í›„ URLì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥
   - íŒŒì¼ ì‚­ì œ ì‹œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œë„ URL ì œê±°
   - íŠ¸ëœì­ì…˜ì´ë‚˜ ì²´í¬í¬ì¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„° ì¼ê´€ì„± ë³´ì¥

---

# ì‹¤ì œ êµ¬í˜„ ì˜ˆì œ

## Svelte ì»´í¬ë„ŒíŠ¸ì—ì„œ í”„ë¡œí•„ ì‚¬ì§„ ì—…ë¡œë“œ

ê¸°ì¡´ `UserProfile.svelte`ì—ì„œ êµ¬í˜„í•œ í”„ë¡œí•„ ì‚¬ì§„ ì—…ë¡œë“œ ë°©ì‹:

```javascript
// src/demo/UserProfile.svelteì˜ ì˜ˆì œ
import { ref as storageRef, uploadBytes, getDownloadURL } from 'firebase/storage';
import { storage } from '$lib/utils/firebase.js';

async function handleSubmit(event) {
  event.preventDefault();
  isSaving = true;

  try {
    const updateData = {
      displayName: formData.displayName,
      gender: formData.gender,
      dateOfBirth: formData.dateOfBirth
    };

    // íŒŒì¼ì´ ì„ íƒëœ ê²½ìš° ì—…ë¡œë“œ
    if (file) {
      const fileName = `${Date.now()}-${file.name}`;
      const photoStorageRef = storageRef(storage, `users/${login.uid}/profile/${fileName}`);

      // íŒŒì¼ ì—…ë¡œë“œ
      const snapshot = await uploadBytes(photoStorageRef, file);

      // ë‹¤ìš´ë¡œë“œ URL íšë“
      const downloadURL = await getDownloadURL(snapshot.ref);
      updateData.photoURL = downloadURL;
    }

    // í”„ë¡œí•„ ì—…ë°ì´íŠ¸ (Auth + RTDB)
    await login.updateProfile(updateData);

    // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
    successMessage = 'í”„ë¡œí•„ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤';
    setTimeout(() => {
      successMessage = '';
    }, 3000);

    // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
    file = null;
    preview = null;

  } catch (error) {
    console.error('ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
    errorMessage = 'í”„ë¡œí•„ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message;
  } finally {
    isSaving = false;
  }
}
```

---

# ì°¸ê³  ì‚¬í•­

1. **ì†Œí”„íŠ¸ ì‚­ì œ**: Firebase Storageì˜ ì‚­ì œëœ íŒŒì¼ì€ 7ì¼ê°„ ë³µêµ¬ ê°€ëŠ¥í•©ë‹ˆë‹¤
2. **ë³´ì•ˆ ê·œì¹™**: ë°˜ë“œì‹œ ë³´ì•ˆ ê·œì¹™ì„ ì„¤ì •í•˜ì—¬ ë¬´ë‹¨ ì—…ë¡œë“œ/ì‚­ì œë¥¼ ë°©ì§€í•˜ì„¸ìš”
3. **ë¹„ìš©**: Firebase StorageëŠ” ì €ì¥ ê³µê°„ê³¼ ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ì— ë”°ë¼ ë¹„ìš©ì´ ì²­êµ¬ë©ë‹ˆë‹¤
4. **íŒŒì¼ ê²½ë¡œ êµ¬ì¡°**: `/users/{userId}/` í•˜ìœ„ì— íŒŒì¼ì„ êµ¬ì¡°í™”í•˜ì—¬ ê´€ë¦¬í•˜ì„¸ìš”
5. **URL ê°±ì‹ **: ë‹¤ìš´ë¡œë“œ URLì€ ì‚¬ìš©ì UIDê°€ ë³€ê²½ë˜ê±°ë‚˜ ë³´ì•ˆ ê·œì¹™ ë³€ê²½ ì‹œ ê°±ì‹ í•´ì•¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

---

# íŒŒì¼ ì—…ë¡œë“œ ì›¹ ì»´í¬ë„ŒíŠ¸ ì‹œìŠ¤í…œ

ë³¸ ì„¹ì…˜ì—ì„œëŠ” ì¬ì‚¬ìš© ê°€ëŠ¥í•œ íŒŒì¼ ì—…ë¡œë“œ ì›¹ ì»´í¬ë„ŒíŠ¸ ì‹œìŠ¤í…œì„ ì†Œê°œí•©ë‹ˆë‹¤. ì´ ì‹œìŠ¤í…œì€ ê²Œì‹œê¸€, ëŒ“ê¸€ ë“± ë‹¤ì–‘í•œ ê³³ì—ì„œ íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥ì„ ì‰½ê²Œ í†µí•©í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

## ì‹œìŠ¤í…œ ê°œìš”

íŒŒì¼ ì—…ë¡œë“œ ì›¹ ì»´í¬ë„ŒíŠ¸ ì‹œìŠ¤í…œì€ ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì„± ìš”ì†Œë¡œ ì´ë£¨ì–´ì ¸ ìˆìŠµë‹ˆë‹¤:

1. **FileUploadTrigger.wc.svelte**: íŒŒì¼ ì„ íƒ ë° ì—…ë¡œë“œë¥¼ ì‹œì‘í•˜ëŠ” ë²„íŠ¼ ì»´í¬ë„ŒíŠ¸
2. **FileUploadList.wc.svelte**: ì—…ë¡œë“œëœ íŒŒì¼ ëª©ë¡ì„ í‘œì‹œí•˜ê³  ê´€ë¦¬í•˜ëŠ” ì»´í¬ë„ŒíŠ¸
3. **storage.ts**: Firebase Storage ì‘ì—…ì„ ìœ„í•œ í—¬í¼ í•¨ìˆ˜ë“¤
4. **fileUploadState.ts**: ë‘ ì»´í¬ë„ŒíŠ¸ ê°„ ìƒíƒœë¥¼ ê³µìœ í•˜ëŠ” ì „ì—­ ìƒíƒœ ê´€ë¦¬

### ì£¼ìš” íŠ¹ì§•

- âœ… **ë¶„ë¦¬ëœ UI ì»´í¬ë„ŒíŠ¸**: ì—…ë¡œë“œ ë²„íŠ¼ê³¼ íŒŒì¼ ëª©ë¡ì„ ë…ë¦½ì ìœ¼ë¡œ ë°°ì¹˜ ê°€ëŠ¥
- âœ… **ìƒíƒœ ê³µìœ **: ê°™ì€ `id`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‘ ì»´í¬ë„ŒíŠ¸ ê°„ ìƒíƒœ ë™ê¸°í™”
- âœ… **ì‹¤ì‹œê°„ ì§„í–‰ë¥  í‘œì‹œ**: ì—…ë¡œë“œ ì§„í–‰ ìƒí™©ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í‘œì‹œ
- âœ… **ë‹¤ì¤‘ íŒŒì¼ ì—…ë¡œë“œ**: ì—¬ëŸ¬ íŒŒì¼ì„ ë™ì‹œì— ì—…ë¡œë“œ ê°€ëŠ¥
- âœ… **íŒŒì¼ ê²€ì¦**: íŒŒì¼ í¬ê¸°(5MB) ë° íƒ€ì…(JPEG, PNG, WebP) ìë™ ê²€ì¦
- âœ… **í¸ì§‘ ëª¨ë“œ ì§€ì›**: ê¸°ì¡´ íŒŒì¼ ëª©ë¡ì„ ë¡œë“œí•˜ì—¬ ìˆ˜ì • ê°€ëŠ¥
- âœ… **Firebase Storage í†µí•©**: ìë™ìœ¼ë¡œ `/users/{userId}/{category}/{timestamp}-{filename}` ê²½ë¡œì— ì €ì¥
- âœ… **Svelte 5 Web Components**: shadow: 'none' ë°©ì‹ìœ¼ë¡œ ìŠ¤íƒ€ì¼ë§ ììœ ë„ ë†’ìŒ

## ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          fileUploadState.ts (ì „ì—­ ìƒíƒœ)         â”‚
â”‚  - Map<id, FileState> êµ¬ì¡°ë¡œ ìƒíƒœ ì €ì¥          â”‚
â”‚  - subscribe/notify íŒ¨í„´ìœ¼ë¡œ ë³€ê²½ ì•Œë¦¼          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†‘                          â†‘
            â”‚                          â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ FileUploadTriggerâ”‚        â”‚ FileUploadList  â”‚
   â”‚   (ì—…ë¡œë“œ ë²„íŠ¼)   â”‚        â”‚   (íŒŒì¼ ëª©ë¡)    â”‚
   â”‚                 â”‚        â”‚                â”‚
   â”‚ - íŒŒì¼ ì„ íƒ      â”‚        â”‚ - ì§„í–‰ë¥  í‘œì‹œ   â”‚
   â”‚ - ì—…ë¡œë“œ ì‹œì‘    â”‚        â”‚ - íŒŒì¼ ì‚­ì œ     â”‚
   â”‚ - storage.ts í˜¸ì¶œâ”‚        â”‚ - getUrls() ë©”ì„œë“œâ”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   storage.ts     â”‚
   â”‚ (í—¬í¼ í•¨ìˆ˜)       â”‚
   â”‚                 â”‚
   â”‚ - uploadFileWithProgress â”‚
   â”‚ - deleteFileByUrl        â”‚
   â”‚ - validateFile           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Firebase Storage â”‚
   â”‚ /users/{uid}/... â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Svelte 5 Web Component ì†ì„± ë§¤í•‘

**ğŸ”¥ ì¤‘ìš”: Svelte 5 Web Componentì—ì„œ HTML ì†ì„±ê³¼ Props ë§¤í•‘**

Svelte 5 Web ComponentëŠ” HTML ì†ì„±(kebab-case)ê³¼ JavaScript props(camelCase) ê°„ ìë™ ë§¤í•‘ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ kebab-case ì†ì„±ì„ ì‚¬ìš©í•˜ë ¤ë©´ `$props()`ì—ì„œ ëª…ì‹œì ìœ¼ë¡œ ë§¤í•‘í•´ì•¼ í•©ë‹ˆë‹¤.

### ë¬¸ì œ ìƒí™©

**âŒ ì˜ëª»ëœ ë°©ë²• (ì‘ë™í•˜ì§€ ì•ŠìŒ)**:
```typescript
// Props ì •ì˜
let {
  id = '',
  initialUrls = '',  // âŒ initial-urls ì†ì„±ì„ ë°›ì§€ ëª»í•¨
} = $props();
```

```html
<!-- HTML ì‚¬ìš© -->
<file-upload-list
  id="post-edit"
  initial-urls='["https://example.com/image1.jpg"]'
></file-upload-list>
```

**ë¬¸ì œ**: `initial-urls` ì†ì„±ì´ `initialUrls` propìœ¼ë¡œ ìë™ ë§¤í•‘ë˜ì§€ ì•Šì•„ì„œ ê°’ì„ ë°›ì§€ ëª»í•©ë‹ˆë‹¤.

### í•´ê²° ë°©ë²•

**âœ… ì˜¬ë°”ë¥¸ ë°©ë²• (ëª…ì‹œì  ë§¤í•‘)**:
```typescript
// Props ì •ì˜ - kebab-case ì†ì„±ëª…ì„ ë¬¸ìì—´ ë¦¬í„°ëŸ´ë¡œ ë§¤í•‘
let {
  id = '',
  'initial-urls': initialUrls = '',  // âœ… kebab-caseë¥¼ ëª…ì‹œì ìœ¼ë¡œ ë§¤í•‘
}: {
  id?: string;
  'initial-urls'?: string;  // âœ… TypeScript íƒ€ì…ë„ kebab-case ì‚¬ìš©
} = $props();
```

```html
<!-- HTML ì‚¬ìš© (ë™ì¼) -->
<file-upload-list
  id="post-edit"
  initial-urls='["https://example.com/image1.jpg"]'
></file-upload-list>
```

**í•µì‹¬**: `$props()` êµ¬ì¡° ë¶„í•´ì—ì„œ ë¬¸ìì—´ ë¦¬í„°ëŸ´ í”„ë¡œí¼í‹° ì´ë¦„(`'initial-urls'`)ì„ ì‚¬ìš©í•˜ì—¬ camelCase ë³€ìˆ˜(`initialUrls`)ë¡œ ë§¤í•‘í•©ë‹ˆë‹¤.

### ì ìš© ì˜ˆì œ

#### FileUploadList.wc.svelte
```typescript
let {
  id = '',
  'initial-urls': initialUrls = '',
}: {
  id?: string;
  'initial-urls'?: string;
} = $props();
```

#### FileUploadTrigger.wc.svelte
```typescript
// ë‹¨ìˆœí•œ ë‹¨ì–´ëŠ” kebab-case ë§¤í•‘ ë¶ˆí•„ìš”
let {
  id = '',
  category = 'posts',
  multiple = 'true',
  buttonText = '',
}: {
  id?: string;
  category?: UploadCategory;
  multiple?: string;
  buttonText?: string;
} = $props();
```

**ì°¸ê³ **: `buttonText` ê°™ì€ ê²½ìš°, HTMLì—ì„œ `buttontext` ë˜ëŠ” `buttonText`ë¡œ ì „ë‹¬í•  ìˆ˜ ìˆì§€ë§Œ kebab-caseë¥¼ ì„ í˜¸í•  ê²½ìš° `'button-text': buttonText`ë¡œ ëª…ì‹œì ìœ¼ë¡œ ë§¤í•‘í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

### ê·œì¹™ ìš”ì•½

1. **kebab-case HTML ì†ì„± â†’ camelCase Props**: ëª…ì‹œì  ë§¤í•‘ í•„ìš”
   ```typescript
   'initial-urls': initialUrls  // âœ…
   ```

2. **ë‹¨ìˆœí•œ ë‹¨ì–´ (ì†Œë¬¸ì)**: ìë™ ë§¤í•‘ ê°€ëŠ¥
   ```typescript
   id = ''  // âœ… (id ì†ì„± â†’ id prop)
   ```

3. **TypeScript íƒ€ì… ì •ì˜**: kebab-case ì†ì„±ëª…ì„ ë¬¸ìì—´ ë¦¬í„°ëŸ´ë¡œ ì‚¬ìš©
   ```typescript
   {
     'initial-urls'?: string;
   }
   ```

4. **HTML ì‚¬ìš© ì‹œ**: í•­ìƒ kebab-case ì‚¬ìš© (HTML í‘œì¤€)
   ```html
   <file-upload-list initial-urls="..."></file-upload-list>
   ```

## í—¬í¼ í•¨ìˆ˜ (storage.ts)

**íŒŒì¼ ìœ„ì¹˜**: `src/lib/services/storage.ts`

### ì£¼ìš” í•¨ìˆ˜

#### 1. uploadFileWithProgress

íŒŒì¼ì„ Firebase Storageì— ì—…ë¡œë“œí•˜ê³  ì§„í–‰ë¥ ì„ ì¶”ì í•©ë‹ˆë‹¤.

```typescript
/**
 * íŒŒì¼ì„ Firebase Storageì— ì—…ë¡œë“œí•˜ê³  ì§„í–‰ë¥ ì„ ì¶”ì í•©ë‹ˆë‹¤
 *
 * @param userId - ì‚¬ìš©ì UID
 * @param file - ì—…ë¡œë“œí•  íŒŒì¼ ê°ì²´
 * @param category - ì—…ë¡œë“œ ì¹´í…Œê³ ë¦¬ ('posts' | 'comments' | 'profile')
 * @param onProgress - ì§„í–‰ë¥  ì½œë°± í•¨ìˆ˜ (0~100)
 * @returns ì—…ë¡œë“œ ê²°ê³¼ (ì„±ê³µ ì‹œ downloadURL í¬í•¨)
 */
export async function uploadFileWithProgress(
  userId: string,
  file: File,
  category: UploadCategory,
  onProgress?: ProgressCallback
): Promise<UploadResult>
```

**ê²½ë¡œ êµ¬ì¡°**: `/users/{userId}/{category}/{timestamp}-{filename}`

**ì‚¬ìš© ì˜ˆì œ**:
```typescript
const result = await uploadFileWithProgress(
  'user123',
  file,
  'posts',
  (progress) => console.log(`ì§„í–‰ë¥ : ${progress}%`)
);

if (result.success) {
  console.log('ì—…ë¡œë“œ ì™„ë£Œ:', result.downloadURL);
} else {
  console.error('ì—…ë¡œë“œ ì‹¤íŒ¨:', result.error);
}
```

#### 2. deleteFileByUrl

Firebase Storageì—ì„œ URLë¡œ íŒŒì¼ì„ ì‚­ì œí•©ë‹ˆë‹¤.

```typescript
/**
 * Firebase Storageì—ì„œ URLë¡œ íŒŒì¼ì„ ì‚­ì œí•©ë‹ˆë‹¤
 *
 * @param url - ì‚­ì œí•  íŒŒì¼ì˜ ë‹¤ìš´ë¡œë“œ URL
 * @returns ì‚­ì œ ê²°ê³¼ (success, error)
 */
export async function deleteFileByUrl(url: string): Promise<{
  success: boolean;
  error?: string;
}>
```

**ì‚¬ìš© ì˜ˆì œ**:
```typescript
const result = await deleteFileByUrl(fileUrl);
if (result.success) {
  console.log('íŒŒì¼ ì‚­ì œ ì™„ë£Œ');
} else {
  console.error('ì‚­ì œ ì‹¤íŒ¨:', result.error);
}
```

#### 3. validateFile

íŒŒì¼ì˜ í¬ê¸°ì™€ íƒ€ì…ì„ ê²€ì¦í•©ë‹ˆë‹¤.

```typescript
/**
 * íŒŒì¼ ê²€ì¦ (í¬ê¸°, íƒ€ì…)
 *
 * @param file - ê²€ì¦í•  íŒŒì¼ ê°ì²´
 * @returns ê²€ì¦ ê²°ê³¼ (valid, error)
 */
export function validateFile(file: File): ValidationResult
```

**ê²€ì¦ ê·œì¹™**:
- **ìµœëŒ€ íŒŒì¼ í¬ê¸°**: 5MB
- **í—ˆìš© íƒ€ì…**: JPEG, PNG, WebP (image/jpeg, image/png, image/webp)

**ì‚¬ìš© ì˜ˆì œ**:
```typescript
const validation = validateFile(file);
if (!validation.valid) {
  alert(validation.error);
  return;
}
```

### TypeScript ì¸í„°í˜ì´ìŠ¤

```typescript
/**
 * ì—…ë¡œë“œ ì¹´í…Œê³ ë¦¬
 */
export type UploadCategory = 'posts' | 'comments' | 'profile';

/**
 * ì—…ë¡œë“œ ê²°ê³¼
 */
export interface UploadResult {
  success: boolean;
  downloadURL?: string;
  error?: string;
}

/**
 * íŒŒì¼ ê²€ì¦ ê²°ê³¼
 */
export interface ValidationResult {
  valid: boolean;
  error?: string;
}

/**
 * ì§„í–‰ë¥  ì½œë°± í•¨ìˆ˜ (0~100)
 */
export type ProgressCallback = (progress: number) => void;
```

## ìƒíƒœ ê´€ë¦¬ (fileUploadState.ts)

**íŒŒì¼ ìœ„ì¹˜**: `src/lib/services/fileUploadState.ts`

`fileUploadState.ts`ëŠ” `FileUploadTrigger`ì™€ `FileUploadList` ì»´í¬ë„ŒíŠ¸ ê°„ ìƒíƒœë¥¼ ê³µìœ í•˜ëŠ” ì „ì—­ ìƒíƒœ ê´€ë¦¬ ëª¨ë“ˆì…ë‹ˆë‹¤.

### ë°ì´í„° êµ¬ì¡°

```typescript
/**
 * ì—…ë¡œë“œ ì¤‘ì¸ íŒŒì¼ ì •ë³´
 */
export interface UploadingFile {
  id: string;               // íŒŒì¼ ê³ ìœ  ID
  file?: File;              // íŒŒì¼ ê°ì²´ (ì—…ë¡œë“œ ì‹œ)
  url?: string;             // ë‹¤ìš´ë¡œë“œ URL (ì™„ë£Œ ì‹œ)
  progress: number;         // ì§„í–‰ë¥  (0~100)
  status: 'uploading' | 'completed' | 'error';
  error?: string;           // ì—ëŸ¬ ë©”ì‹œì§€
}

/**
 * ì—…ë¡œë” ìƒíƒœ
 */
interface FileState {
  files: UploadingFile[];   // íŒŒì¼ ëª©ë¡
  listeners: Set<() => void>; // ìƒíƒœ ë³€ê²½ ë¦¬ìŠ¤ë„ˆë“¤
}
```

**ì „ì—­ Map êµ¬ì¡°**: `Map<uploaderId, FileState>`
- ê° ì—…ë¡œë”ëŠ” ê³ ìœ í•œ `id`ë¡œ ì‹ë³„ë©ë‹ˆë‹¤
- ê°™ì€ `id`ë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë“¤ì€ ìƒíƒœë¥¼ ê³µìœ í•©ë‹ˆë‹¤

### ì£¼ìš” í•¨ìˆ˜

#### 1. addFile - íŒŒì¼ ì¶”ê°€

```typescript
/**
 * ìƒˆ íŒŒì¼ì„ ì—…ë¡œë”ì— ì¶”ê°€
 *
 * @param id - ì—…ë¡œë” ID
 * @param file - ì¶”ê°€í•  íŒŒì¼ ê°ì²´
 * @returns ìƒì„±ëœ íŒŒì¼ ID
 */
export function addFile(id: string, file: File): string
```

#### 2. updateFileProgress - ì§„í–‰ë¥  ì—…ë°ì´íŠ¸

```typescript
/**
 * íŒŒì¼ ì—…ë¡œë“œ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
 *
 * @param id - ì—…ë¡œë” ID
 * @param fileId - íŒŒì¼ ID
 * @param progress - ì§„í–‰ë¥  (0~100)
 */
export function updateFileProgress(id: string, fileId: string, progress: number): void
```

#### 3. completeFileUpload - ì—…ë¡œë“œ ì™„ë£Œ

```typescript
/**
 * íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ ì²˜ë¦¬
 *
 * @param id - ì—…ë¡œë” ID
 * @param fileId - íŒŒì¼ ID
 * @param url - ë‹¤ìš´ë¡œë“œ URL
 */
export function completeFileUpload(id: string, fileId: string, url: string): void
```

#### 4. removeFile - íŒŒì¼ ì‚­ì œ

```typescript
/**
 * íŒŒì¼ ì œê±°
 *
 * @param id - ì—…ë¡œë” ID
 * @param fileId - íŒŒì¼ ID
 */
export function removeFile(id: string, fileId: string): void
```

#### 5. getUploadedUrls - ì™„ë£Œëœ URL ëª©ë¡ ê°€ì ¸ì˜¤ê¸°

```typescript
/**
 * ì™„ë£Œëœ íŒŒì¼ì˜ URL ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
 *
 * @param id - ì—…ë¡œë” ID
 * @returns URL ë°°ì—´
 */
export function getUploadedUrls(id: string): string[]
```

#### 6. initializeWithUrls - ì´ˆê¸° URL ëª©ë¡ ì„¤ì • (í¸ì§‘ ëª¨ë“œ)

```typescript
/**
 * ê¸°ì¡´ URL ëª©ë¡ìœ¼ë¡œ ì´ˆê¸°í™” (í¸ì§‘ ëª¨ë“œ)
 *
 * @param id - ì—…ë¡œë” ID
 * @param urls - ì´ˆê¸° URL ë°°ì—´
 */
export function initializeWithUrls(id: string, urls: string[]): void
```

#### 7. subscribe - ìƒíƒœ ë³€ê²½ êµ¬ë…

```typescript
/**
 * ìƒíƒœ ë³€ê²½ êµ¬ë…
 *
 * @param id - ì—…ë¡œë” ID
 * @param listener - ë³€ê²½ ì‹œ í˜¸ì¶œë  ì½œë°± í•¨ìˆ˜
 * @returns êµ¬ë… í•´ì œ í•¨ìˆ˜
 */
export function subscribe(id: string, listener: () => void): () => void
```

## FileUploadTrigger ì›¹ ì»´í¬ë„ŒíŠ¸

**íŒŒì¼ ìœ„ì¹˜**: `src/lib/components/FileUploadTrigger.wc.svelte`

íŒŒì¼ ì„ íƒ ë° ì—…ë¡œë“œë¥¼ ì‹œì‘í•˜ëŠ” ë²„íŠ¼ ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.

### Props

```typescript
interface Props {
  id: string;                      // ì—…ë¡œë” ê³ ìœ  ID (í•„ìˆ˜, FileUploadListì™€ ë™ì¼í•˜ê²Œ ì„¤ì •)
  category?: UploadCategory;       // ì—…ë¡œë“œ ì¹´í…Œê³ ë¦¬ (ê¸°ë³¸ê°’: 'posts')
  multiple?: string;               // ë‹¤ì¤‘ ì„ íƒ í—ˆìš© ('true' | 'false', ê¸°ë³¸ê°’: 'true')
  buttonText?: string;             // ë²„íŠ¼ í…ìŠ¤íŠ¸ (ê¸°ë³¸ê°’: i18n 'íŒŒì¼ì„ íƒ')
}
```

**ì°¸ê³ **: Web Componentì—ì„œ ëª¨ë“  HTML ì†ì„±ì€ ë¬¸ìì—´ë¡œ ì „ë‹¬ë˜ë¯€ë¡œ, `multiple`ì€ booleanì´ ì•„ë‹Œ `'true'` | `'false'` ë¬¸ìì—´ì…ë‹ˆë‹¤.

### ì‚¬ìš© ì˜ˆì œ

**ë‹¨ì¼ íŒŒì¼ ì—…ë¡œë“œ ë²„íŠ¼**:
```html
<file-upload-trigger
  id="profile-photo"
  category="profile"
  multiple="false"
  buttonText="í”„ë¡œí•„ ì‚¬ì§„ ì„ íƒ"
></file-upload-trigger>
```

**ë‹¤ì¤‘ íŒŒì¼ ì—…ë¡œë“œ ë²„íŠ¼ (ê²Œì‹œê¸€)**:
```html
<file-upload-trigger
  id="post-create"
  category="posts"
  multiple="true"
  buttonText="ì´ë¯¸ì§€ ì²¨ë¶€"
></file-upload-trigger>
```

### ë™ì‘ ë°©ì‹

1. ì‚¬ìš©ìê°€ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ `<input type="file">` ë‹¤ì´ì–¼ë¡œê·¸ê°€ ì—´ë¦½ë‹ˆë‹¤
2. íŒŒì¼ ì„ íƒ í›„:
   - `validateFile()`ë¡œ íŒŒì¼ ê²€ì¦ (íŒŒì¼ í¬ê¸°, íƒ€ì… í™•ì¸)
   - ê²€ì¦ í†µê³¼ ì‹œ `uploadFileWithProgress()`ë¡œ ì—…ë¡œë“œ ì‹œì‘
   - ì§„í–‰ë¥ ì„ `fileUploadState`ì— ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
3. ì—…ë¡œë“œ ì™„ë£Œ ì‹œ:
   - ë‹¤ìš´ë¡œë“œ URLì„ `fileUploadState`ì— ì €ì¥
   - `FileUploadList` ì»´í¬ë„ŒíŠ¸ê°€ ìë™ìœ¼ë¡œ ëª©ë¡ ê°±ì‹ 

### ìƒì„¸ êµ¬í˜„ ë¡œì§

#### 1. Props ì²˜ë¦¬

```typescript
let {
  id = '',
  category = 'posts',
  multiple = 'true',
  buttonText = '',
}: {
  id?: string;
  category?: UploadCategory;
  multiple?: string;
  buttonText?: string;
} = $props();

// ë¬¸ìì—´ â†’ boolean ë³€í™˜
const isMultiple = $derived(multiple === 'true' || multiple === '');

// ë²„íŠ¼ í…ìŠ¤íŠ¸ (ê¸°ë³¸ê°’ ë˜ëŠ” ì‚¬ìš©ì ì§€ì •)
const displayButtonText = $derived(buttonText || $t('íŒŒì¼ì„ íƒ'));
```

#### 2. íŒŒì¼ ì„ íƒ ì²˜ë¦¬

```typescript
async function handleFileChange(event: Event) {
  const input = event.target as HTMLInputElement;
  const files = input?.files;

  if (!files || files.length === 0) return;

  // 1. ì—…ë¡œë” ID ê²€ì¦
  if (!id) {
    console.error('[FileUploadTrigger] id prop is required');
    alert($t('error.file.invalidUrl'));
    return;
  }

  // 2. ë¡œê·¸ì¸ í™•ì¸
  if (!login.isAuthenticated || !login.uid) {
    alert($t('ë¡œê·¸ì¸í•„ìš”'));
    return;
  }

  // 3. íŒŒì¼ ê²€ì¦ (ê° íŒŒì¼ë§ˆë‹¤)
  const filesArray = Array.from(files);
  for (const file of filesArray) {
    const validation = validateFile(file);
    if (!validation.valid) {
      alert(validation.error);
      // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
      if (input) {
        input.value = '';
      }
      return;
    }
  }

  // 4. íŒŒì¼ ì—…ë¡œë“œ ì‹œì‘
  isUploading = true;

  try {
    // ì„ íƒí•œ ëª¨ë“  íŒŒì¼ì„ ë³‘ë ¬ë¡œ ì—…ë¡œë“œ
    const uploadPromises = filesArray.map((file) =>
      uploadSingleFile(file)
    );

    await Promise.all(uploadPromises);
  } catch (error) {
    console.error('[FileUploadTrigger] Upload error:', error);
  } finally {
    isUploading = false;
    // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™” (ì¬ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡)
    if (input) {
      input.value = '';
    }
  }
}
```

#### 3. ë‹¨ì¼ íŒŒì¼ ì—…ë¡œë“œ

```typescript
async function uploadSingleFile(file: File) {
  // 1. íŒŒì¼ ìƒíƒœ ì¶”ê°€ (fileUploadStateì— ë“±ë¡)
  const fileId = addFile(id, file);

  try {
    // 2. Firebase Storageì— ì—…ë¡œë“œ (ì§„í–‰ë¥  ì¶”ì )
    const result = await uploadFileWithProgress(
      login.uid!,
      file,
      category as UploadCategory,
      (progress) => {
        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ (0~100)
        updateFileProgress(id, fileId, progress);
      }
    );

    // 3. ì—…ë¡œë“œ ê²°ê³¼ ì²˜ë¦¬
    if (result.success && result.url) {
      // ì„±ê³µ: URL ì €ì¥
      completeFileUpload(id, fileId, result.url);
    } else {
      // ì‹¤íŒ¨: ì—ëŸ¬ ë©”ì‹œì§€ ì €ì¥
      const errorMessage = result.error ? $t(result.error) : $t('error.unknown');
      failFileUpload(id, fileId, errorMessage);
    }
  } catch (error) {
    console.error('[FileUploadTrigger] Upload failed:', error);
    const errorMessage =
      error instanceof Error ? error.message : $t('error.unknown');
    failFileUpload(id, fileId, errorMessage);
  }
}
```

#### 4. UI êµ¬ì¡°

```html
<div class="file-upload-trigger">
  <!-- ìˆ¨ê²¨ì§„ íŒŒì¼ ì…ë ¥ -->
  <input
    type="file"
    bind:this={fileInput}
    onchange={handleFileChange}
    accept={ACCEPT_STRING}
    multiple={isMultiple}
    style="display: none;"
    aria-label={displayButtonText}
  />

  <!-- ì—…ë¡œë“œ ë²„íŠ¼ -->
  <button
    type="button"
    class="upload-button"
    onclick={handleButtonClick}
    disabled={isUploading}
    aria-label={displayButtonText}
  >
    <ImagePlus size={20} />
    <span class="button-text">{displayButtonText}</span>
    {#if isUploading}
      <span class="uploading-indicator">â³</span>
    {/if}
  </button>
</div>
```

#### 5. ì£¼ìš” ê¸°ëŠ¥

- **íŒŒì¼ ê²€ì¦**: í¬ê¸°, íƒ€ì… ì œí•œ í™•ì¸ (`fileValidation.ts`)
- **ë¡œê·¸ì¸ í™•ì¸**: ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ì—…ë¡œë“œ ë¶ˆê°€
- **ë‹¤ì¤‘ íŒŒì¼ ì—…ë¡œë“œ**: `Promise.all()`ë¡œ ë³‘ë ¬ ì²˜ë¦¬
- **ì§„í–‰ë¥  ì¶”ì **: ê° íŒŒì¼ì˜ ì—…ë¡œë“œ ì§„í–‰ë¥ ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ `fileUploadState`ì— ì—…ë°ì´íŠ¸
- **ì—ëŸ¬ ì²˜ë¦¬**: ì—…ë¡œë“œ ì‹¤íŒ¨ ì‹œ ì‚¬ìš©ìì—ê²Œ ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
- **UI í”¼ë“œë°±**: ì—…ë¡œë“œ ì¤‘ ë²„íŠ¼ ë¹„í™œì„±í™” ë° ì¸ë””ì¼€ì´í„° í‘œì‹œ

## FileUploadList ì›¹ ì»´í¬ë„ŒíŠ¸

**íŒŒì¼ ìœ„ì¹˜**: `src/lib/components/FileUploadList.wc.svelte`

ì—…ë¡œë“œëœ íŒŒì¼ ëª©ë¡ì„ í‘œì‹œí•˜ê³  ê´€ë¦¬í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.

### Props

```typescript
interface Props {
  id: string;                      // ì—…ë¡œë” ê³ ìœ  ID (í•„ìˆ˜, FileUploadTriggerì™€ ë™ì¼í•˜ê²Œ ì„¤ì •)
  'initial-urls'?: string;         // ì´ˆê¸° URL ëª©ë¡ JSON ë¬¸ìì—´ (í¸ì§‘ ëª¨ë“œìš©)
}
```

**ğŸ”¥ ì¤‘ìš”**: `initial-urls`ëŠ” kebab-case HTML ì†ì„±ì´ë¯€ë¡œ, `$props()`ì—ì„œ ëª…ì‹œì ìœ¼ë¡œ ë§¤í•‘í•´ì•¼ í•©ë‹ˆë‹¤:

```typescript
let {
  id = '',
  'initial-urls': initialUrls = '',  // âœ… kebab-case â†’ camelCase ë§¤í•‘
}: {
  id?: string;
  'initial-urls'?: string;
} = $props();
```

### ì‚¬ìš© ì˜ˆì œ

**ì‹ ê·œ ìƒì„± ëª¨ë“œ**:
```html
<file-upload-list id="post-create"></file-upload-list>
```

**í¸ì§‘ ëª¨ë“œ (ê¸°ì¡´ íŒŒì¼ ë¡œë“œ)**:
```html
<file-upload-list
  id="post-edit"
  initial-urls='["https://example.com/image1.jpg", "https://example.com/image2.jpg"]'
></file-upload-list>
```

**Svelte ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©**:
```html
<file-upload-list
  id="post-edit-{postId}"
  initial-urls={JSON.stringify(post.urls || [])}
></file-upload-list>
```

### ë™ì‘ ë°©ì‹

1. **onMount ì‹œ**:
   - `initial-urls`ê°€ ìˆìœ¼ë©´ JSON íŒŒì‹±í•˜ì—¬ `initializeWithUrls()` í˜¸ì¶œ
   - `fileUploadState` êµ¬ë…í•˜ì—¬ ìƒíƒœ ë³€ê²½ ê°ì§€
   - ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ `getUrls()` ë©”ì„œë“œë¥¼ DOM ìš”ì†Œì— ë“±ë¡

2. **ìƒíƒœ ë³€ê²½ ì‹œ**:
   - ìë™ìœ¼ë¡œ UI ì—…ë°ì´íŠ¸ (ì§„í–‰ë¥ , ì™„ë£Œ, ì—ëŸ¬)
   - íŒŒì¼ ëª©ë¡ì„ ê·¸ë¦¬ë“œë¡œ í‘œì‹œ (5ì—´ ë ˆì´ì•„ì›ƒ)

3. **ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì‹œ**:
   - ì‚¬ìš©ìì—ê²Œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
   - Firebase Storageì—ì„œ íŒŒì¼ ì‚­ì œ (`deleteFileByUrl`)
   - `fileUploadState`ì—ì„œ íŒŒì¼ ì œê±°

### ì™¸ë¶€ì—ì„œ URL ëª©ë¡ ê°€ì ¸ì˜¤ê¸°

í¼ ì œì¶œ ì‹œ ì—…ë¡œë“œëœ íŒŒì¼ì˜ URL ë°°ì—´ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

**ë°©ë²• 1: fileUploadState ì§ì ‘ ì‚¬ìš© (ê¶Œì¥)**
```typescript
import { getUploadedUrls } from '../lib/services/fileUploadState';

// âœ… ëª¨ë“  ê²½ìš°ì— ì‘ë™ (Portal ì‚¬ìš© ì‹œì—ë„ ì•ˆì „)
const urls = getUploadedUrls('post-create');

console.log('ì—…ë¡œë“œëœ íŒŒì¼ URLs:', urls);
// ì¶œë ¥: ['https://...', 'https://...']
```

**ë°©ë²• 2: DOM querySelector ì‚¬ìš© (ë¹„ê¶Œì¥ - Portal ì‚¬ìš© ì‹œ ì‹¤íŒ¨ ê°€ëŠ¥)**
```typescript
// âŒ Portalì„ ì‚¬ìš©í•˜ëŠ” ëª¨ë‹¬ì—ì„œëŠ” ì´ ë°©ì‹ì´ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŒ
const fileUploadList = document.querySelector('file-upload-list[id="post-create"]');
// @ts-ignore
const urls = fileUploadList?.getUrls ? fileUploadList.getUrls() : [];
```

**ê¶Œì¥**: í•­ìƒ `getUploadedUrls()` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•ˆì „í•©ë‹ˆë‹¤.

### UI í‘œì‹œ í•­ëª©

- **ìƒíƒœë³„ UI**:
  - â³ **ì—…ë¡œë“œ ì¤‘**: ì§„í–‰ë¥  ì˜¤ë²„ë ˆì´ í‘œì‹œ (0~100%)
  - âœ… **ì™„ë£Œ**: ì´ˆë¡ìƒ‰ í…Œë‘ë¦¬, ì‚­ì œ ë²„íŠ¼ í‘œì‹œ
  - âŒ **ì—ëŸ¬**: ë¹¨ê°„ìƒ‰ í…Œë‘ë¦¬, ì—ëŸ¬ ì•„ì´ì½˜, ì‚­ì œ ë²„íŠ¼ í‘œì‹œ

- **íŒŒì¼ íƒ€ì…ë³„ ë¯¸ë¦¬ë³´ê¸°**:
  - ğŸ“· **ì´ë¯¸ì§€ íŒŒì¼**: ì¸ë„¤ì¼ ì´ë¯¸ì§€ í‘œì‹œ
  - ğŸ¥ **ë™ì˜ìƒ íŒŒì¼**: ë¹„ë””ì˜¤ í”Œë ˆì´ì–´ í‘œì‹œ
  - ğŸ“„ **ë¬¸ì„œ íŒŒì¼**: í™•ì¥ì í‘œì‹œ (PDF, ZIP ë“±)

- **ë ˆì´ì•„ì›ƒ**:
  - ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ (ë°ìŠ¤í¬í†± 5ì—´, íƒœë¸”ë¦¿/ëª¨ë°”ì¼ 4ì—´)
  - ì •ì‚¬ê°í˜• ë¹„ìœ¨ ìœ ì§€ (aspect-ratio: 1)
  - ì‚­ì œ ë²„íŠ¼ì€ ì™¼ìª½ ìƒë‹¨ì— ë°°ì¹˜

### ìƒì„¸ êµ¬í˜„ ë¡œì§

#### 1. Props ì²˜ë¦¬ ë° ì´ˆê¸°í™”

```typescript
let {
  id = '',
  'initial-urls': initialUrls = '',  // âœ… kebab-case ë§¤í•‘
}: {
  id?: string;
  'initial-urls'?: string;
} = $props();

// íŒŒì¼ ëª©ë¡ (ë°˜ì‘í˜• ìƒíƒœ)
let files: UploadingFile[] = $state([]);

onMount(() => {
  // ì—…ë¡œë” ID ê²€ì¦
  if (!id) {
    console.error('[FileUploadList] id prop is required');
    return;
  }

  // ì´ˆê¸° URL ëª©ë¡ì´ ìˆìœ¼ë©´ ì´ˆê¸°í™” (ìˆ˜ì • ëª¨ë“œ)
  if (initialUrls) {
    try {
      const urls = JSON.parse(initialUrls) as string[];
      if (Array.isArray(urls) && urls.length > 0) {
        console.log(`[FileUploadList] Initializing with ${urls.length} URLs for id: ${id}`);
        initializeWithUrls(id, urls);
      }
    } catch (error) {
      console.error('[FileUploadList] Failed to parse initial-urls:', error);
    }
  }

  // ìƒíƒœ ë³€ê²½ êµ¬ë…
  unsubscribe = subscribe(id, () => {
    files = getFiles(id);
  });

  // ì´ˆê¸° íŒŒì¼ ëª©ë¡ ë¡œë“œ
  files = getFiles(id);

  // ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ ë©”ì„œë“œ ë“±ë¡
  if (typeof window !== 'undefined') {
    const element = document.querySelector(`file-upload-list[id="${id}"]`);
    if (element) {
      // @ts-ignore
      element.getUrls = () => getUploadedUrls(id);
    }
  }
});
```

**ê°œì„  ì‚¬í•­**: ì´ì „ì—ëŠ” DOM querySelectorë¡œ ì†ì„±ì„ ì½ëŠ” ë³µì¡í•œ ë¡œì§ì´ ìˆì—ˆì§€ë§Œ, ì´ì œ `$props()`ì˜ kebab-case ë§¤í•‘ìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

#### 2. íŒŒì¼ ì‚­ì œ ì²˜ë¦¬

```typescript
async function handleDeleteFile(fileId: string, url?: string) {
  if (deletingFileIds.has(fileId)) return;

  const confirmDelete = confirm($t('íŒŒì¼ì‚­ì œ'));
  if (!confirmDelete) return;

  deletingFileIds.add(fileId);

  try {
    // Firebase Storageì—ì„œ íŒŒì¼ ì‚­ì œ (URLì´ ìˆëŠ” ê²½ìš°)
    if (url) {
      const result = await deleteFileByUrl(url);
      if (!result.success) {
        console.error('[FileUploadList] Failed to delete file from Storage:', result.error);
        // Storage ì‚­ì œ ì‹¤íŒ¨í•´ë„ ëª©ë¡ì—ì„œëŠ” ì œê±° (ì‚¬ìš©ì ê²½í—˜ ê°œì„ )
      }
    }

    // ìƒíƒœì—ì„œ íŒŒì¼ ì œê±°
    removeFile(id, fileId);
  } catch (error) {
    console.error('[FileUploadList] Delete error:', error);
    alert($t('íŒŒì¼ì‚­ì œì‹¤íŒ¨'));
  } finally {
    deletingFileIds.delete(fileId);
  }
}
```

#### 3. íŒŒì¼ íƒ€ì…ë³„ ë¯¸ë¦¬ë³´ê¸° ë Œë”ë§

```html
<div class="file-preview">
  {#if isImageFile(file)}
    <!-- ì´ë¯¸ì§€ íŒŒì¼ -->
    <img src={getPreviewUrl(file)} alt={getFileName(file)} class="preview-image" />
  {:else if isVideoFile(file)}
    <!-- ë™ì˜ìƒ íŒŒì¼ -->
    <video src={getVideoUrl(file)} class="preview-video" controls>
      <track kind="captions" />
    </video>
  {:else}
    <!-- ë¬¸ì„œ íŒŒì¼ - í™•ì¥ì í‘œì‹œ -->
    <div class="file-extension">
      <div class="extension-text">{getFileExtension(file)}</div>
    </div>
  {/if}

  <!-- ì§„í–‰ë¥  ì˜¤ë²„ë ˆì´ (ì—…ë¡œë“œ ì¤‘) -->
  {#if file.status === 'uploading'}
    <div class="progress-overlay">
      <div class="progress-circle">{file.progress}%</div>
    </div>
  {/if}

  <!-- ì—ëŸ¬ ì˜¤ë²„ë ˆì´ -->
  {#if file.status === 'error'}
    <div class="error-overlay">
      <AlertCircle size={32} class="error-icon" />
      <div class="error-text">{$t('ì—…ë¡œë“œì‹¤íŒ¨')}</div>
    </div>
  {/if}

  <!-- ì‚­ì œ ë²„íŠ¼ (ì™¼ìª½ ìƒë‹¨) -->
  {#if file.status === 'completed' || file.status === 'error'}
    <button
      type="button"
      class="delete-button"
      onclick={() => handleDeleteFile(file.id, file.url)}
      disabled={deletingFileIds.has(file.id)}
      aria-label={$t('íŒŒì¼ì‚­ì œ')}
    >
      <X size={16} />
    </button>
  {/if}
</div>
```

#### 4. í—¬í¼ í•¨ìˆ˜ë“¤

```typescript
// íŒŒì¼ ì´ë¦„ ì¶”ì¶œ (URL ë˜ëŠ” File ê°ì²´ì—ì„œ)
function getFileName(file: UploadingFile): string {
  if (file.file && file.file.name) {
    return file.file.name;
  }
  if (file.url) {
    // URLì—ì„œ íŒŒì¼ëª… ì¶”ì¶œ ë° ë””ì½”ë”©
    try {
      const urlObj = new URL(file.url);
      const pathname = urlObj.pathname;
      const parts = pathname.split('/');
      const fileName = parts[parts.length - 1];
      return decodeURIComponent(fileName);
    } catch {
      return 'íŒŒì¼';
    }
  }
  return 'íŒŒì¼';
}

// ì´ë¯¸ì§€ íŒŒì¼ ì—¬ë¶€ í™•ì¸
function isImageFile(file: UploadingFile): boolean {
  if (file.file && file.file.type.startsWith('image/')) {
    return true;
  }
  if (file.url) {
    // URL í™•ì¥ìë¡œ íŒë‹¨
    const lowerUrl = file.url.toLowerCase();
    return lowerUrl.includes('.jpg') || lowerUrl.includes('.jpeg') ||
           lowerUrl.includes('.png') || lowerUrl.includes('.gif') ||
           lowerUrl.includes('.webp') || lowerUrl.includes('.bmp') ||
           lowerUrl.includes('.svg');
  }
  return false;
}

// ë™ì˜ìƒ íŒŒì¼ ì—¬ë¶€ í™•ì¸
function isVideoFile(file: UploadingFile): boolean {
  if (file.file && file.file.type.startsWith('video/')) {
    return true;
  }
  if (file.url) {
    const lowerUrl = file.url.toLowerCase();
    return lowerUrl.includes('.mp4') || lowerUrl.includes('.webm') ||
           lowerUrl.includes('.mov') || lowerUrl.includes('.avi') ||
           lowerUrl.includes('.mkv');
  }
  return false;
}

// íŒŒì¼ í™•ì¥ì ì¶”ì¶œ
function getFileExtension(file: UploadingFile): string {
  const fileName = getFileName(file);
  const parts = fileName.split('.');
  if (parts.length > 1) {
    return parts[parts.length - 1].toUpperCase();
  }
  return 'FILE';
}
```

#### 5. ì£¼ìš” ê¸°ëŠ¥

- **ì´ˆê¸° URL ë¡œë“œ**: í¸ì§‘ ëª¨ë“œì—ì„œ ê¸°ì¡´ íŒŒì¼ ëª©ë¡ í‘œì‹œ
- **ì‹¤ì‹œê°„ ë™ê¸°í™”**: `fileUploadState` êµ¬ë…ìœ¼ë¡œ ìƒíƒœ ë³€ê²½ ìë™ ë°˜ì˜
- **íŒŒì¼ íƒ€ì…ë³„ UI**: ì´ë¯¸ì§€, ë™ì˜ìƒ, ë¬¸ì„œ íŒŒì¼ì„ ê°ê° ë‹¤ë¥´ê²Œ í‘œì‹œ
- **ì§„í–‰ë¥  í‘œì‹œ**: ì—…ë¡œë“œ ì¤‘ì¸ íŒŒì¼ì˜ ì§„í–‰ë¥ ì„ ì˜¤ë²„ë ˆì´ë¡œ í‘œì‹œ
- **ì—ëŸ¬ ì²˜ë¦¬**: ì—…ë¡œë“œ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ì˜¤ë²„ë ˆì´ í‘œì‹œ
- **íŒŒì¼ ì‚­ì œ**: Firebase Storageì™€ ìƒíƒœ ê´€ë¦¬ ë™ê¸°í™”
- **ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ**: ë°ìŠ¤í¬í†±(5ì—´), íƒœë¸”ë¦¿/ëª¨ë°”ì¼(4ì—´)

## ê²Œì‹œê¸€ì—ì„œì˜ ì‚¬ìš© ì˜ˆì œ

**íŒŒì¼ ìœ„ì¹˜**: `src/demo/PostListPage.svelte`

### 1. ì›¹ ì»´í¬ë„ŒíŠ¸ Import

```typescript
import '../lib/components/FileUploadTrigger.wc.svelte';
import '../lib/components/FileUploadList.wc.svelte';
```

### 2. ëª¨ë‹¬ UIì— ì¶”ê°€

```html
<!-- ê²Œì‹œê¸€ ìƒì„± ëª¨ë‹¬ -->
<Dialog bind:open={isNewPostDialogOpen}>
  <form onsubmit={handleSubmit}>
    <!-- ì œëª© ì…ë ¥ -->
    <input type="text" bind:value={postTitle} />

    <!-- ë‚´ìš© ì…ë ¥ -->
    <textarea bind:value={postContent}></textarea>

    <!-- íŒŒì¼ ì—…ë¡œë“œ íŠ¸ë¦¬ê±° -->
    <div class="form-group">
      <label>{$t("íŒŒì¼ì²¨ë¶€")}</label>
      <div class="file-upload-area">
        <file-upload-trigger
          id="post-create"
          category="posts"
          multiple="true"
          buttonText={$t("ì´ë¯¸ì§€ì²¨ë¶€")}
        ></file-upload-trigger>
      </div>
    </div>

    <!-- íŒŒì¼ ëª©ë¡ -->
    <file-upload-list id="post-create"></file-upload-list>

    <!-- ì œì¶œ ë²„íŠ¼ -->
    <button type="submit">{$t("ë“±ë¡")}</button>
  </form>
</Dialog>
```

### 3. ì œì¶œ ì‹œ URL ê°€ì ¸ì˜¤ê¸°

**âš ï¸ ì¤‘ìš”**: Portal íŒ¨í„´ì„ ì‚¬ìš©í•˜ëŠ” ëª¨ë‹¬ì—ì„œëŠ” DOM querySelectorê°€ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `fileUploadState`ì—ì„œ ì§ì ‘ URLì„ ê°€ì ¸ì˜¤ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•˜ì„¸ìš”.

```typescript
import { getUploadedUrls, destroyUploader } from '../lib/services/fileUploadState';

async function handleSubmit(event: Event) {
  event.preventDefault();

  // 1. í¼ ê²€ì¦
  if (!postTitle.trim() || !postContent.trim()) {
    alert('ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
    return;
  }

  // 2. ì‚¬ìš©ì ì •ë³´ í™•ì¸
  const userId = $login.uid;
  const userName = $login.displayName || 'ìµëª…';

  // 3. ì—…ë¡œë“œëœ íŒŒì¼ URL ëª©ë¡ ê°€ì ¸ì˜¤ê¸° (fileUploadStateì—ì„œ ì§ì ‘ ê°€ì ¸ì˜¤ê¸°)
  // Portal ì‚¬ìš©ìœ¼ë¡œ ì¸í•´ DOM querySelectorê°€ ì‹¤íŒ¨í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ìƒíƒœì—ì„œ ì§ì ‘ ê°€ì ¸ì˜µë‹ˆë‹¤.
  const urls = getUploadedUrls('post-create');

  // 4. Firebase RTDBì— ê²Œì‹œê¸€ ì €ì¥ (íŒŒì¼ URL í¬í•¨)
  const result = await createPost(
    postCategory,
    userId,
    userName,
    postTitle,
    postContent,
    urls.length > 0 ? urls : undefined
  );

  // 5. ê²°ê³¼ ì²˜ë¦¬
  if (result.success) {
    // íŒŒì¼ ì—…ë¡œë“œ ìƒíƒœ ì •ë¦¬
    destroyUploader('post-create');

    alert('ê²Œì‹œê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤');
    isNewPostDialogOpen = false;
    // í¼ ì´ˆê¸°í™”
    postTitle = '';
    postContent = '';
  } else {
    alert('ê²Œì‹œê¸€ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + result.error);
  }
}

/**
 * ëª¨ë‹¬ ì·¨ì†Œ í•¸ë“¤ëŸ¬
 */
function handleCancel() {
  // íŒŒì¼ ì—…ë¡œë“œ ìƒíƒœ ì •ë¦¬
  destroyUploader('post-create');

  isNewPostDialogOpen = false;
  postTitle = '';
  postContent = '';
}
```

**DOM querySelector ë°©ì‹ (ë¹„ê¶Œì¥ - Portal ì‚¬ìš© ì‹œ ì‹¤íŒ¨ ê°€ëŠ¥)**:
```typescript
// âŒ Portalì„ ì‚¬ìš©í•˜ëŠ” ëª¨ë‹¬ì—ì„œëŠ” ì´ ë°©ì‹ì´ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
const fileUploadList = document.querySelector('file-upload-list[id="post-create"]');
// @ts-ignore
const urls = fileUploadList?.getUrls ? fileUploadList.getUrls() : [];
```

**fileUploadState ì§ì ‘ ì‚¬ìš© ë°©ì‹ (ê¶Œì¥)**:
```typescript
// âœ… ëª¨ë“  ê²½ìš°ì— ì‘ë™í•©ë‹ˆë‹¤
import { getUploadedUrls } from '../lib/services/fileUploadState';
const urls = getUploadedUrls('post-create');
```

### 4. forum.ts ì„œë¹„ìŠ¤ í•¨ìˆ˜ ìˆ˜ì •

**íŒŒì¼ ìœ„ì¹˜**: `src/lib/services/forum.ts`

```typescript
export async function createPost(
  category: PostCategory,
  uid: UserId,
  author: string,
  title: string,
  content: string,
  urls?: string[]  // â† ì¶”ê°€
): Promise<CreatePostResult> {
  // ... ê¸°ì¡´ ì½”ë“œ ...

  const postData: any = {
    uid: uid,
    title: title,
    content: content,
    author: author,
    category: category,
    order: order,
    createdAt: now,
    updatedAt: now,
    likeCount: 0,
    commentCount: 0
  };

  // ì²¨ë¶€ íŒŒì¼ URL ì¶”ê°€ (ìˆëŠ” ê²½ìš°)
  if (urls && urls.length > 0) {
    postData.urls = urls;
  }

  // ... ì €ì¥ ë¡œì§ ...
}
```

### 5. í¸ì§‘ ëª¨ë“œ ì˜ˆì œ

```html
<!-- ê²Œì‹œê¸€ ìˆ˜ì • ëª¨ë‹¬ -->
<Dialog bind:open={isEditDialogOpen}>
  <form onsubmit={handleEditSubmit}>
    <!-- ì œëª© ì…ë ¥ -->
    <input type="text" bind:value={editTitle} />

    <!-- ë‚´ìš© ì…ë ¥ -->
    <textarea bind:value={editContent}></textarea>

    <!-- íŒŒì¼ ì—…ë¡œë“œ (ê¸°ì¡´ íŒŒì¼ ë¡œë“œ) -->
    <file-upload-trigger
      id="post-edit-{editingPost.postId}"
      category="posts"
      multiple="true"
      buttonText={$t("ì´ë¯¸ì§€ì²¨ë¶€")}
    ></file-upload-trigger>

    <!-- íŒŒì¼ ëª©ë¡ (initial-urlsë¡œ ê¸°ì¡´ íŒŒì¼ í‘œì‹œ) -->
    <file-upload-list
      id="post-edit-{editingPost.postId}"
      initial-urls={JSON.stringify(editingPost.urls || [])}
    ></file-upload-list>

    <!-- ì œì¶œ ë²„íŠ¼ -->
    <button type="submit">{$t("ìˆ˜ì •")}</button>
  </form>
</Dialog>
```

```typescript
import { getUploadedUrls, destroyUploader } from '../lib/services/fileUploadState';

async function handleEditSubmit(event: Event) {
  event.preventDefault();

  // URL ê°€ì ¸ì˜¤ê¸° (fileUploadStateì—ì„œ ì§ì ‘ ê°€ì ¸ì˜¤ê¸°)
  const urls = getUploadedUrls(`post-edit-${editingPost.postId}`);

  // ê²Œì‹œê¸€ ì—…ë°ì´íŠ¸
  const result = await updatePost(
    editingPost.postId,
    {
      title: editTitle,
      content: editContent,
      urls: urls.length > 0 ? urls : undefined
    }
  );

  // ê²°ê³¼ ì²˜ë¦¬
  if (result.success) {
    // íŒŒì¼ ì—…ë¡œë“œ ìƒíƒœ ì •ë¦¬
    destroyUploader(`post-edit-${editingPost.postId}`);

    alert('ê²Œì‹œê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤');
    isEditDialogOpen = false;
  } else {
    alert('ê²Œì‹œê¸€ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + result.error);
  }
}

/**
 * í¸ì§‘ ì·¨ì†Œ í•¸ë“¤ëŸ¬
 */
function handleEditCancel() {
  // íŒŒì¼ ì—…ë¡œë“œ ìƒíƒœ ì •ë¦¬
  destroyUploader(`post-edit-${editingPost.postId}`);

  isEditDialogOpen = false;
  editTitle = '';
  editContent = '';
}
```

## ëŒ“ê¸€ì—ì„œì˜ ì‚¬ìš© ì˜ˆì œ

**íŒŒì¼ ìœ„ì¹˜**: `src/demo/CommentItem.svelte`

### 1. ì›¹ ì»´í¬ë„ŒíŠ¸ Import

```typescript
import '../lib/components/FileUploadTrigger.wc.svelte';
import '../lib/components/FileUploadList.wc.svelte';
```

### 2. ë‹µê¸€ ëª¨ë‹¬ì— ì¶”ê°€

```html
<!-- ë‹µê¸€ ì‘ì„± ëª¨ë‹¬ -->
<Dialog bind:open={isReplyDialogOpen}>
  <form onsubmit={handleReplySubmit}>
    <!-- ë‹µê¸€ ë‚´ìš© ì…ë ¥ -->
    <textarea bind:value={replyContent}></textarea>

    <!-- íŒŒì¼ ì—…ë¡œë“œ íŠ¸ë¦¬ê±° -->
    <div class="file-upload-section">
      <file-upload-trigger
        id="comment-reply-{comment.commentId}"
        category="comments"
        multiple="true"
        buttonText={$t("ì´ë¯¸ì§€ì²¨ë¶€")}
      ></file-upload-trigger>
    </div>

    <!-- íŒŒì¼ ëª©ë¡ -->
    <file-upload-list id="comment-reply-{comment.commentId}"></file-upload-list>

    <!-- ì œì¶œ ë²„íŠ¼ -->
    <button type="submit">{$t("ë‹µê¸€ë“±ë¡")}</button>
  </form>
</Dialog>
```

### 3. ë‹µê¸€ ì œì¶œ ì‹œ URL ê°€ì ¸ì˜¤ê¸°

```typescript
import { getUploadedUrls, destroyUploader } from '../lib/services/fileUploadState';

async function handleReplySubmit() {
  // 1. ë‚´ìš© ê²€ì¦
  if (!replyContent.trim()) {
    alert('ë‹µê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
    return;
  }

  // 2. ì‚¬ìš©ì ì •ë³´ í™•ì¸
  const userId = $login.uid;

  // 3. ì—…ë¡œë“œëœ íŒŒì¼ URL ëª©ë¡ ê°€ì ¸ì˜¤ê¸° (fileUploadStateì—ì„œ ì§ì ‘ ê°€ì ¸ì˜¤ê¸°)
  const urls = getUploadedUrls(`comment-reply-${comment.commentId}`);

  // 4. Firebaseì— ë‹µê¸€ ì €ì¥ (Flat Style êµ¬ì¡°)
  const result = await createChildComment({
    parentCommentId: comment.commentId,
    userId: userId,
    content: replyContent,
    urls: urls.length > 0 ? urls : undefined
  });

  // 5. ê²°ê³¼ ì²˜ë¦¬
  if (result.success) {
    // íŒŒì¼ ì—…ë¡œë“œ ìƒíƒœ ì •ë¦¬
    destroyUploader(`comment-reply-${comment.commentId}`);

    alert('ë‹µê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤');
    isReplyDialogOpen = false;
    replyContent = '';
  } else {
    alert('ë‹µê¸€ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + result.error);
  }
}

/**
 * ë‹µê¸€ ì·¨ì†Œ í•¸ë“¤ëŸ¬
 */
function handleReplyCancel() {
  // íŒŒì¼ ì—…ë¡œë“œ ìƒíƒœ ì •ë¦¬
  destroyUploader(`comment-reply-${comment.commentId}`);

  isReplyDialogOpen = false;
  replyContent = '';
}
```

### 4. ëŒ“ê¸€ ìˆ˜ì • ëª¨ë‹¬ì— ì¶”ê°€ (ê¸°ì¡´ íŒŒì¼ ë¡œë“œ)

```html
<!-- ëŒ“ê¸€ ìˆ˜ì • ëª¨ë‹¬ -->
<Dialog bind:open={isEditDialogOpen}>
  <form onsubmit={handleEditSubmit}>
    <!-- ëŒ“ê¸€ ë‚´ìš© ì…ë ¥ -->
    <textarea bind:value={editContent}></textarea>

    <!-- íŒŒì¼ ì—…ë¡œë“œ (ê¸°ì¡´ íŒŒì¼ ë¡œë“œ) -->
    <file-upload-trigger
      id="comment-edit-{comment.commentId}"
      category="comments"
      multiple="true"
      buttonText={$t("ì´ë¯¸ì§€ì²¨ë¶€")}
    ></file-upload-trigger>

    <!-- íŒŒì¼ ëª©ë¡ (initial-urlsë¡œ ê¸°ì¡´ íŒŒì¼ í‘œì‹œ) -->
    <file-upload-list
      id="comment-edit-{comment.commentId}"
      initial-urls={JSON.stringify(comment.urls || [])}
    ></file-upload-list>

    <!-- ì œì¶œ ë²„íŠ¼ -->
    <button type="submit">{$t("ìˆ˜ì •")}</button>
  </form>
</Dialog>
```

```typescript
import { getUploadedUrls, destroyUploader } from '../lib/services/fileUploadState';

async function handleEditSubmit() {
  // 1. ë‚´ìš© ê²€ì¦
  if (!editContent.trim()) {
    alert('ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
    return;
  }

  // 2. ì—…ë¡œë“œëœ íŒŒì¼ URL ëª©ë¡ ê°€ì ¸ì˜¤ê¸° (fileUploadStateì—ì„œ ì§ì ‘ ê°€ì ¸ì˜¤ê¸°)
  const urls = getUploadedUrls(`comment-edit-${comment.commentId}`);

  // 3. Firebaseì— ëŒ“ê¸€ ì—…ë°ì´íŠ¸
  const result = await updateComment(comment.commentId, {
    content: editContent,
    urls: urls.length > 0 ? urls : undefined
  });

  // 4. ê²°ê³¼ ì²˜ë¦¬
  if (result.success) {
    // íŒŒì¼ ì—…ë¡œë“œ ìƒíƒœ ì •ë¦¬
    destroyUploader(`comment-edit-${comment.commentId}`);

    alert('ëŒ“ê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤');
    isEditDialogOpen = false;
    editContent = '';
  } else {
    alert('ëŒ“ê¸€ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + result.error);
  }
}

/**
 * ëŒ“ê¸€ ìˆ˜ì • ì·¨ì†Œ í•¸ë“¤ëŸ¬
 */
function handleEditCancel() {
  // íŒŒì¼ ì—…ë¡œë“œ ìƒíƒœ ì •ë¦¬
  destroyUploader(`comment-edit-${comment.commentId}`);

  isEditDialogOpen = false;
  editContent = '';
}
```

### 5. comment.ts ì„œë¹„ìŠ¤ í•¨ìˆ˜ ìˆ˜ì •

**íŒŒì¼ ìœ„ì¹˜**: `src/lib/services/comment.ts`

```typescript
// ìµœìƒìœ„ ëŒ“ê¸€ ìƒì„±
export async function createTopLevelComment(
  params: CreateTopLevelCommentParams
): Promise<CreateCommentResult> {
  const { postId, userId, content, urls } = params;  // â† urls ì¶”ê°€

  // ... ê¸°ì¡´ ì½”ë“œ ...

  const commentData: any = {
    postId: postId,
    uid: userId,
    content: content,
    depth: 1,
    order: orderString,
    parentId: null,
    createdAt: now,
    updatedAt: now,
  };

  // ì²¨ë¶€ íŒŒì¼ URL ì¶”ê°€ (ìˆëŠ” ê²½ìš°)
  if (urls && urls.length > 0) {
    commentData.urls = urls;
  }

  // ... ì €ì¥ ë¡œì§ ...
}

// ëŒ€ëŒ“ê¸€ ìƒì„±
export async function createChildComment(
  params: CreateChildCommentParams
): Promise<CreateCommentResult> {
  const { parentCommentId, userId, content, urls } = params;  // â† urls ì¶”ê°€

  // ... ê¸°ì¡´ ì½”ë“œ ...

  const commentData: any = {
    postId: postId,
    uid: userId,
    content: content,
    depth: newDepth,
    order: newOrder,
    parentId: parentCommentId,
    createdAt: now,
    updatedAt: now,
  };

  // ì²¨ë¶€ íŒŒì¼ URL ì¶”ê°€ (ìˆëŠ” ê²½ìš°)
  if (urls && urls.length > 0) {
    commentData.urls = urls;
  }

  // ... ì €ì¥ ë¡œì§ ...
}

// ëŒ“ê¸€ ìˆ˜ì •
export async function updateComment(
  commentId: FirebaseKey,
  updates: { content: string; urls?: string[] }  // â† urls ì¶”ê°€
): Promise<CreateCommentResult> {
  // ... ê¸°ì¡´ ì½”ë“œ ...

  const updateData: Record<string, any> = {};
  updateData[`comments/${commentId}/content`] = updates.content;
  updateData[`comments/${commentId}/updatedAt`] = now;

  // ì²¨ë¶€ íŒŒì¼ URL ì—…ë°ì´íŠ¸ (ìˆëŠ” ê²½ìš°)
  if (updates.urls !== undefined) {
    if (updates.urls.length > 0) {
      updateData[`comments/${commentId}/urls`] = updates.urls;
    } else {
      // urlsê°€ ë¹ˆ ë°°ì—´ì´ë©´ í•„ë“œ ì‚­ì œ (nullë¡œ ì„¤ì •)
      updateData[`comments/${commentId}/urls`] = null;
    }
  }

  await update(ref(database), updateData);

  // ... ê²°ê³¼ ë°˜í™˜ ...
}
```

## URL ì €ì¥ ë° ê´€ë¦¬

### Firebase RTDB ë°ì´í„° êµ¬ì¡°

íŒŒì¼ URL ë°°ì—´ì€ ê° ê²Œì‹œê¸€/ëŒ“ê¸€ ë…¸ë“œì— `urls` í•„ë“œë¡œ ì €ì¥ë©ë‹ˆë‹¤:

**ê²Œì‹œê¸€ êµ¬ì¡°** (`/posts/{postId}`):
```json
{
  "postId": "post-abc123",
  "uid": "user123",
  "title": "ê²Œì‹œê¸€ ì œëª©",
  "content": "ê²Œì‹œê¸€ ë‚´ìš©",
  "urls": [
    "https://firebasestorage.googleapis.com/.../image1.jpg",
    "https://firebasestorage.googleapis.com/.../image2.jpg"
  ],
  "createdAt": 1234567890,
  "updatedAt": 1234567890
}
```

**ëŒ“ê¸€ êµ¬ì¡°** (`/comments/{commentId}`):
```json
{
  "commentId": "comment-xyz789",
  "postId": "post-abc123",
  "uid": "user456",
  "content": "ëŒ“ê¸€ ë‚´ìš©",
  "urls": [
    "https://firebasestorage.googleapis.com/.../photo.jpg"
  ],
  "depth": 1,
  "order": "post-abc123-00001",
  "parentId": null,
  "createdAt": 1234567890,
  "updatedAt": 1234567890
}
```

### URL ë°°ì—´ ê´€ë¦¬ ê·œì¹™

1. **ì‹ ê·œ ìƒì„± ì‹œ**:
   - URLì´ ìˆìœ¼ë©´ ë°°ì—´ë¡œ ì €ì¥: `urls: [...]`
   - URLì´ ì—†ìœ¼ë©´ í•„ë“œ ìì²´ë¥¼ ì¶”ê°€í•˜ì§€ ì•ŠìŒ (undefined)

2. **ìˆ˜ì • ì‹œ**:
   - URLì´ ìˆìœ¼ë©´ ë°°ì—´ë¡œ ì—…ë°ì´íŠ¸: `urls: [...]`
   - URLì´ ì—†ìœ¼ë©´ í•„ë“œ ì‚­ì œ: `urls: null`

3. **ì¡°íšŒ ì‹œ**:
   - `urls` í•„ë“œê°€ ì—†ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ í•­ìƒ optional chaining ì‚¬ìš©
   - ì˜ˆ: `post.urls || []`, `comment.urls || []`

### TypeScript ì¸í„°í˜ì´ìŠ¤

**ê²Œì‹œê¸€ íƒ€ì…** (`src/lib/types/forum.ts`):
```typescript
export interface Post {
  postId: FirebaseKey;
  uid: UserId;
  title: string;
  content: string;
  urls?: string[];  // â† ì„ íƒ í•„ë“œ
  category: PostCategory;
  order: string;
  createdAt: Timestamp;
  updatedAt: Timestamp;
  likeCount: number;
  commentCount: number;
}
```

**ëŒ“ê¸€ íƒ€ì…** (`src/lib/types/comment.ts`):
```typescript
export interface Comment {
  postId: FirebaseKey;
  uid: UserId;
  content: string;
  urls?: string[];  // â† ì„ íƒ í•„ë“œ
  depth: number;
  order: string;
  parentId: FirebaseKey | null;
  likeCount: number;
  commentCount: number;
  createdAt: Timestamp;
  updatedAt: Timestamp;
}
```

## ì›¹ ì»´í¬ë„ŒíŠ¸ ìŠ¤íƒ€ì¼ë§

ë‘ ì»´í¬ë„ŒíŠ¸ ëª¨ë‘ `shadow: 'none'` ë°©ì‹ì„ ì‚¬ìš©í•˜ë¯€ë¡œ ì™¸ë¶€ CSSë¡œ ìŠ¤íƒ€ì¼ì„ ì‰½ê²Œ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ê¸°ë³¸ í´ë˜ìŠ¤ëª…

**FileUploadTrigger**:
- `.file-upload-trigger` - ë²„íŠ¼ ì»¨í…Œì´ë„ˆ
- `.upload-button` - ì‹¤ì œ ë²„íŠ¼ ìš”ì†Œ

**FileUploadList**:
- `.file-upload-list` - ëª©ë¡ ì»¨í…Œì´ë„ˆ
- `.empty-state` - íŒŒì¼ ì—†ìŒ ìƒíƒœ
- `.files-container` - íŒŒì¼ ëª©ë¡
- `.file-item` - ê°œë³„ íŒŒì¼ í•­ëª©
- `.file-item.uploading` - ì—…ë¡œë“œ ì¤‘ ìƒíƒœ
- `.file-item.completed` - ì™„ë£Œ ìƒíƒœ
- `.file-item.error` - ì—ëŸ¬ ìƒíƒœ
- `.progress-bar-container` - ì§„í–‰ë¥  ë°” ì»¨í…Œì´ë„ˆ
- `.delete-button` - ì‚­ì œ ë²„íŠ¼

### ìŠ¤íƒ€ì¼ ì»¤ìŠ¤í„°ë§ˆì´ì§• ì˜ˆì œ

```css
/* ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³€ê²½ */
file-upload-trigger .upload-button {
  background-color: #4CAF50;
  color: white;
  padding: 12px 24px;
  border-radius: 8px;
}

/* íŒŒì¼ í•­ëª© ìŠ¤íƒ€ì¼ ë³€ê²½ */
file-upload-list .file-item {
  background-color: #f0f0f0;
  border: 2px solid #ddd;
  padding: 16px;
}

/* ì§„í–‰ë¥  ë°” ìƒ‰ìƒ ë³€ê²½ */
file-upload-list .progress-bar {
  background: linear-gradient(90deg, #FF6B6B 0%, #FF8787 100%);
}
```

## ê³ ê¸‰ ì‚¬ìš© ì˜ˆì œ

### 1. ë™ì  ID ìƒì„±

ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë™ì‹œì— ì‚¬ìš©í•  ë•ŒëŠ” ë™ì  IDë¥¼ ìƒì„±í•©ë‹ˆë‹¤:

```typescript
// ê° ëŒ“ê¸€ë§ˆë‹¤ ê³ ìœ í•œ ì—…ë¡œë” ID ì‚¬ìš©
const uploaderId = `comment-reply-${comment.commentId}`;
```

```html
<file-upload-trigger id={uploaderId} category="comments"></file-upload-trigger>
<file-upload-list id={uploaderId}></file-upload-list>
```

### 2. í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ íŒŒì¼ ì¶”ê°€

```typescript
import { addFile, completeFileUpload } from '$lib/services/fileUploadState';

// íŒŒì¼ì„ ì§ì ‘ ì¶”ê°€
const fileId = addFile('my-uploader', file);

// ì—…ë¡œë“œ ì™„ë£Œ ì²˜ë¦¬
completeFileUpload('my-uploader', fileId, downloadURL);
```

### 3. ìƒíƒœ ë³€ê²½ ê°ì§€

```typescript
import { subscribe } from '$lib/services/fileUploadState';

// ìƒíƒœ ë³€ê²½ êµ¬ë…
const unsubscribe = subscribe('my-uploader', () => {
  console.log('íŒŒì¼ ëª©ë¡ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤');
});

// êµ¬ë… í•´ì œ
unsubscribe();
```

## ë¬¸ì œ í•´ê²°

### 1. íŒŒì¼ì´ ì—…ë¡œë“œë˜ì§€ ì•ŠìŒ

**ì›ì¸**: Firebase Storage ë³´ì•ˆ ê·œì¹™ ë˜ëŠ” ì¸ì¦ ë¬¸ì œ

**í•´ê²°**:
- Firebase Consoleì—ì„œ Storage ë³´ì•ˆ ê·œì¹™ í™•ì¸
- ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ (`$login.uid` ì¡´ì¬ ì—¬ë¶€)
- ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸

### 2. Portal ì‚¬ìš© ì‹œ URLì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŒ (ì¤‘ìš”!)

**ì›ì¸**: Portal íŒ¨í„´(`use:portal`)ìœ¼ë¡œ ëª¨ë‹¬ì„ `document.body`ë¡œ ì´ë™ì‹œí‚¤ë©´, `document.querySelector()`ê°€ Web Componentë¥¼ ì°¾ì§€ ëª»í•¨

**ì¦ìƒ**:
```typescript
const fileUploadList = document.querySelector('file-upload-list[id="post-create"]');
console.log(fileUploadList); // null â† ë¬¸ì œ!
```

**í•´ê²°ì±…**: DOM ì¿¼ë¦¬ ëŒ€ì‹  `fileUploadState`ì—ì„œ ì§ì ‘ URLì„ ê°€ì ¸ì˜¤ê¸°

```typescript
// âŒ ì˜ëª»ëœ ë°©ë²• (Portal ì‚¬ìš© ì‹œ ì‹¤íŒ¨)
const fileUploadList = document.querySelector('file-upload-list[id="post-create"]');
// @ts-ignore
const urls = fileUploadList?.getUrls ? fileUploadList.getUrls() : [];

// âœ… ì˜¬ë°”ë¥¸ ë°©ë²• (ëª¨ë“  ê²½ìš°ì— ì‘ë™)
import { getUploadedUrls, destroyUploader } from '../lib/services/fileUploadState';

// URL ê°€ì ¸ì˜¤ê¸°
const urls = getUploadedUrls('post-create');

// ì œì¶œ ì„±ê³µ í›„ ìƒíƒœ ì •ë¦¬
if (result.success) {
  destroyUploader('post-create');
}

// ì·¨ì†Œ ì‹œì—ë„ ìƒíƒœ ì •ë¦¬
function handleCancel() {
  destroyUploader('post-create');
  isDialogOpen = false;
}
```

**ì ìš© ëŒ€ìƒ**:
- PostListPage.svelte (ìƒˆ ê²Œì‹œê¸€ ì‘ì„±)
- PostItem.svelte (ëŒ“ê¸€ ì‘ì„±, ê²Œì‹œê¸€ ìˆ˜ì •)
- CommentItem.svelte (ë‹µê¸€ ì‘ì„±, ëŒ“ê¸€ ìˆ˜ì •)

### 3. Svelte 5 $destroy() ì—ëŸ¬

**ì›ì¸**: Svelte 5ì—ì„œ Web Componentê°€ DOMì—ì„œ ì œê±°ë  ë•Œ `$destroy()` ë©”ì„œë“œ í˜¸ì¶œ ì‹œë„

**ì—ëŸ¬ ë©”ì‹œì§€**:
```
Uncaught (in promise) Svelte error: component_api_changed
Calling `$destroy()` on a component instance is no longer valid in Svelte 5
```

**í•´ê²°ì±…**: FileUploadList.wc.svelteì—ì„œ `onDestroy` í›… ì œê±°

```typescript
// âŒ Svelte 5 Web Componentì—ì„œëŠ” ì‚¬ìš© ê¸ˆì§€
import { onMount, onDestroy } from 'svelte';

onDestroy(() => {
  if (unsubscribe) {
    unsubscribe();
  }
});

// âœ… Svelte 5 Web Componentì—ì„œëŠ” onDestroy ì œê±°
import { onMount } from 'svelte';

/**
 * Svelte 5 Web Component ì •ë¦¬ ì²˜ë¦¬
 *
 * Svelte 5ì—ì„œëŠ” onDestroy() ëŒ€ì‹  Web Componentì˜ disconnectedCallback()ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
 * Web Componentê°€ DOMì—ì„œ ì œê±°ë  ë•Œ Svelteê°€ ìë™ìœ¼ë¡œ ì •ë¦¬í•˜ë¯€ë¡œ onDestroyëŠ” ì œê±°í–ˆìŠµë‹ˆë‹¤.
 *
 * ì°¸ê³ : https://svelte.dev/docs/svelte/v5-migration-guide#Components-are-no-longer-classes
 */
// onDestroyëŠ” Svelte 5 Web Componentì—ì„œ $destroy() ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¤ë¯€ë¡œ ì œê±°
// êµ¬ë… í•´ì œëŠ” Web Componentê°€ ì œê±°ë  ë•Œ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.
```

**ì ìš© íŒŒì¼**:
- FileUploadList.wc.svelte

### 4. ë‘ ì»´í¬ë„ŒíŠ¸ê°€ ìƒíƒœë¥¼ ê³µìœ í•˜ì§€ ì•ŠìŒ

**ì›ì¸**: `id` propì´ ì„œë¡œ ë‹¤ë¦„

**í•´ê²°**:
- `FileUploadTrigger`ì™€ `FileUploadList`ì˜ `id` propì´ ì •í™•íˆ ë™ì¼í•œì§€ í™•ì¸

```html
<!-- ì˜¬ë°”ë¥¸ ì˜ˆ -->
<file-upload-trigger id="post-create"></file-upload-trigger>
<file-upload-list id="post-create"></file-upload-list>

<!-- ì˜ëª»ëœ ì˜ˆ -->
<file-upload-trigger id="post-create"></file-upload-trigger>
<file-upload-list id="post-upload"></file-upload-list> <!-- âŒ id ë¶ˆì¼ì¹˜ -->
```

### 3. ë‘ ì»´í¬ë„ŒíŠ¸ê°€ ìƒíƒœë¥¼ ê³µìœ í•˜ì§€ ì•ŠìŒ

**ì›ì¸**: `id` propì´ ì„œë¡œ ë‹¤ë¦„

**í•´ê²°**:
- `FileUploadTrigger`ì™€ `FileUploadList`ì˜ `id` propì´ ì •í™•íˆ ë™ì¼í•œì§€ í™•ì¸

```html
<!-- ì˜¬ë°”ë¥¸ ì˜ˆ -->
<file-upload-trigger id="post-create"></file-upload-trigger>
<file-upload-list id="post-create"></file-upload-list>

<!-- ì˜ëª»ëœ ì˜ˆ -->
<file-upload-trigger id="post-create"></file-upload-trigger>
<file-upload-list id="post-upload"></file-upload-list> <!-- âŒ id ë¶ˆì¼ì¹˜ -->
```

### 5. í¸ì§‘ ëª¨ë“œì—ì„œ ê¸°ì¡´ íŒŒì¼ì´ í‘œì‹œë˜ì§€ ì•ŠìŒ

**ì›ì¸ 1**: Svelte 5 Web Componentì—ì„œ `initial-urls` ì†ì„±ì´ `initialUrls` propìœ¼ë¡œ ìë™ ë§¤í•‘ë˜ì§€ ì•ŠìŒ

**í•´ê²°**:
- `$props()`ì—ì„œ kebab-case ì†ì„±ì„ ëª…ì‹œì ìœ¼ë¡œ ë§¤í•‘í•´ì•¼ í•©ë‹ˆë‹¤

```typescript
// âŒ ì˜ëª»ëœ ë°©ë²• (ì‘ë™í•˜ì§€ ì•ŠìŒ)
let {
  id = '',
  initialUrls = '',  // initial-urls ì†ì„±ì„ ë°›ì§€ ëª»í•¨
} = $props();

// âœ… ì˜¬ë°”ë¥¸ ë°©ë²• (kebab-case ëª…ì‹œì  ë§¤í•‘)
let {
  id = '',
  'initial-urls': initialUrls = '',  // âœ…
}: {
  id?: string;
  'initial-urls'?: string;
} = $props();
```

**ì›ì¸ 2**: `initial-urls` propì— JSON ë¬¸ìì—´ì´ ì˜¬ë°”ë¥´ê²Œ ì „ë‹¬ë˜ì§€ ì•ŠìŒ

**í•´ê²°**:
- `initial-urls` propì— JSON ë¬¸ìì—´ë¡œ ì „ë‹¬
- ë¹ˆ ë°°ì—´ë„ ì²˜ë¦¬ë˜ë„ë¡ `|| []` ì‚¬ìš©

```html
<!-- âœ… ì˜¬ë°”ë¥¸ ë°©ë²• -->
<file-upload-list
  id="post-edit"
  initial-urls={JSON.stringify(post.urls || [])}
></file-upload-list>

<!-- âŒ ì˜ëª»ëœ ë°©ë²• (JSON ë¬¸ìì—´ì´ ì•„ë‹˜) -->
<file-upload-list
  id="post-edit"
  initial-urls={post.urls}
></file-upload-list>
```

### 6. ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€

**ì›ì¸**: ëª¨ë‹¬ì„ ë‹«ì„ ë•Œ íŒŒì¼ ì—…ë¡œë“œ ìƒíƒœê°€ ì •ë¦¬ë˜ì§€ ì•ŠìŒ

**í•´ê²°**: ëª¨ë‹¬ ë‹«ê¸° ë° ì·¨ì†Œ í•¸ë“¤ëŸ¬ì—ì„œ `destroyUploader()` í˜¸ì¶œ

```typescript
import { destroyUploader } from '../lib/services/fileUploadState';

// ì œì¶œ ì„±ê³µ í›„ ì •ë¦¬
async function handleSubmit() {
  const result = await createPost(...);

  if (result.success) {
    destroyUploader('post-create'); // âœ… ìƒíƒœ ì •ë¦¬
    isDialogOpen = false;
  }
}

// ì·¨ì†Œ ì‹œ ì •ë¦¬
function handleCancel() {
  destroyUploader('post-create'); // âœ… ìƒíƒœ ì •ë¦¬
  isDialogOpen = false;
}
```

## ì •ë¦¬

íŒŒì¼ ì—…ë¡œë“œ ì›¹ ì»´í¬ë„ŒíŠ¸ ì‹œìŠ¤í…œì€ ë‹¤ìŒê³¼ ê°™ì€ ì¥ì ì„ ì œê³µí•©ë‹ˆë‹¤:

âœ… **ì¬ì‚¬ìš©ì„±**: ê²Œì‹œê¸€, ëŒ“ê¸€, í”„ë¡œí•„ ë“± ë‹¤ì–‘í•œ ê³³ì—ì„œ ì‚¬ìš© ê°€ëŠ¥
âœ… **ìœ ì—°ì„±**: ì—…ë¡œë“œ ë²„íŠ¼ê³¼ íŒŒì¼ ëª©ë¡ì„ ë…ë¦½ì ìœ¼ë¡œ ë°°ì¹˜ ê°€ëŠ¥
âœ… **ì‚¬ìš©ì ê²½í—˜**: ì‹¤ì‹œê°„ ì§„í–‰ë¥  í‘œì‹œ, íŒŒì¼ ê²€ì¦, ì—ëŸ¬ ì²˜ë¦¬
âœ… **íƒ€ì… ì•ˆì „ì„±**: TypeScript ì¸í„°í˜ì´ìŠ¤ë¡œ íƒ€ì… ì²´í¬
âœ… **Firebase í†µí•©**: Storage ì—…ë¡œë“œ ë° RTDB URL ì €ì¥ ìë™í™”
âœ… **í¸ì§‘ ì§€ì›**: ê¸°ì¡´ íŒŒì¼ ë¡œë“œ ë° ìˆ˜ì • ê¸°ëŠ¥
âœ… **Portal í˜¸í™˜**: Portal íŒ¨í„´ê³¼ í•¨ê»˜ ì‚¬ìš© ì‹œì—ë„ ì•ˆì •ì ìœ¼ë¡œ ì‘ë™
âœ… **Svelte 5 í˜¸í™˜**: Svelte 5 Web Component í‘œì¤€ ì¤€ìˆ˜

ì´ ì‹œìŠ¤í…œì„ í™œìš©í•˜ì—¬ SNS ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë‹¤ì–‘í•œ ê¸°ëŠ¥ì—ì„œ íŒŒì¼ ì—…ë¡œë“œë¥¼ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì¤‘ìš”í•œ êµ¬í˜„ ê·œì¹™ (í•„ìˆ˜)

### 1. URL ê°€ì ¸ì˜¤ê¸°ëŠ” í•­ìƒ fileUploadState ì‚¬ìš©

âŒ **ì˜ëª»ëœ ë°©ë²•** (Portal ì‚¬ìš© ì‹œ ì‹¤íŒ¨):
```typescript
const element = document.querySelector('file-upload-list[id="post-create"]');
const urls = element?.getUrls?.() || [];
```

âœ… **ì˜¬ë°”ë¥¸ ë°©ë²•** (ëª¨ë“  ê²½ìš°ì— ì‘ë™):
```typescript
import { getUploadedUrls } from '../lib/services/fileUploadState';
const urls = getUploadedUrls('post-create');
```

### 2. ìƒíƒœ ì •ë¦¬ëŠ” í•­ìƒ destroyUploader ì‚¬ìš©

ëª¨ë‹¬ì„ ë‹«ê±°ë‚˜ ì œì¶œì´ ì™„ë£Œë˜ë©´ ë°˜ë“œì‹œ `destroyUploader()`ë¥¼ í˜¸ì¶œí•˜ì—¬ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ë°©ì§€í•©ë‹ˆë‹¤:

```typescript
import { destroyUploader } from '../lib/services/fileUploadState';

// ì œì¶œ ì„±ê³µ í›„
if (result.success) {
  destroyUploader('post-create');
}

// ì·¨ì†Œ ì‹œ
function handleCancel() {
  destroyUploader('post-create');
}
```

### 3. Svelte 5 Web Componentì—ì„œëŠ” onDestroy ì‚¬ìš© ê¸ˆì§€

FileUploadList.wc.svelte ë“± Web Component íŒŒì¼ì—ì„œëŠ” `onDestroy` í›…ì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Svelteê°€ ìë™ìœ¼ë¡œ ì •ë¦¬í•©ë‹ˆë‹¤.

---

**Last Updated**: 2025-01-06
**Version**: 1.2.0 (Svelte 5 kebab-case ì†ì„± ë§¤í•‘ ê°œì„ )

### ë³€ê²½ ì´ë ¥

- **v1.2.0** (2025-01-06): Svelte 5 kebab-case ì†ì„± ë§¤í•‘ ê°œì„ 
  - **ì‹ ê·œ ì„¹ì…˜ ì¶”ê°€**: "Svelte 5 Web Component ì†ì„± ë§¤í•‘" ì„¤ëª…
  - FileUploadList.wc.svelte Propsì—ì„œ kebab-case ëª…ì‹œì  ë§¤í•‘ ì„¤ëª… (`'initial-urls': initialUrls`)
  - FileUploadTrigger.wc.svelte ìƒì„¸ êµ¬í˜„ ë¡œì§ ì¶”ê°€
  - FileUploadList.wc.svelte ìƒì„¸ êµ¬í˜„ ë¡œì§ ì¶”ê°€ (ê°„ì†Œí™”ëœ onMount ë¡œì§ í¬í•¨)
  - ë¬¸ì œ í•´ê²° ì„¹ì…˜ ì—…ë°ì´íŠ¸ (kebab-case ë§¤í•‘ ì´ìŠˆ ì¶”ê°€)
  - ê°œì„  ì‚¬í•­: DOM querySelector ëŒ€ì‹  `$props()`ì˜ kebab-case ë§¤í•‘ ì‚¬ìš©ìœ¼ë¡œ ì½”ë“œ ê°„ì†Œí™”

- **v1.1.0** (2025-11-06): Portal í˜¸í™˜ì„± ê°œì„  ë° Svelte 5 ì—…ë°ì´íŠ¸
  - `getUploadedUrls()` ì§ì ‘ í˜¸ì¶œ ë°©ì‹ìœ¼ë¡œ ë³€ê²½ (Portal í˜¸í™˜)
  - `destroyUploader()` ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€ ì¶”ê°€
  - FileUploadList.wc.svelteì—ì„œ `onDestroy` ì œê±° (Svelte 5 í˜¸í™˜)
  - ë¬¸ì œ í•´ê²° ì„¹ì…˜ ëŒ€í­ ê°•í™”

- **v1.0.0**: ì´ˆê¸° íŒŒì¼ ì—…ë¡œë“œ ì›¹ ì»´í¬ë„ŒíŠ¸ ì‹œìŠ¤í…œ êµ¬í˜„

