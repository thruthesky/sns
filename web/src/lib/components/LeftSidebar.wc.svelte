<svelte:options customElement="sns-left-sidebar" />

<script lang="ts">
  /**
   * ì™¼ìª½ ì‚¬ì´ë“œë°” ì»´í¬ë„ŒíŠ¸ (Web Component)
   *
   * í€µë©”ë‰´ ë§í¬ì™€ ì¸ì¦ ìƒíƒœì— ë”°ë¥¸ ë¹ ë¥¸ ì ‘ê·¼ ë§í¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
   *
   * ì‚¬ìš©ë²•:
   * <sns-left-sidebar></sns-left-sidebar>
   */

  import {
    Home,
    MessageCircle,
    Users,
    User,
    FileText,
    ExternalLink,
    BookOpen,
    LogIn
  } from 'lucide-svelte';
  import { user } from '../stores/auth.js';
  import { t, locale, setLocale, SUPPORTED_LOCALES } from '../stores/i18n.js';

  /**
   * ì–¸ì–´ ì˜µì…˜ ëª©ë¡
   * SUPPORTED_LOCALESì—ì„œ ê°€ì ¸ì˜¨ ì–¸ì–´ ì„¤ì • ë°°ì—´
   */
  const LANGUAGE_OPTIONS = SUPPORTED_LOCALES;
</script>

<!-- ì™¼ìª½ ì‚¬ì´ë“œë°” -->
<aside class="sidebar">
  <div class="sidebar-content">
    <!-- í€µë©”ë‰´ -->
    <h2 class="section-title">{$t('í€µë©”ë‰´')}</h2>
    <nav class="menu">
      <!-- í™ˆ -->
      <a href="/" class="menu-item">
        <Home size={20} />
        <span>{$t('í™ˆ')}</span>
      </a>

      <!-- ì±„íŒ… -->
      <a href="/chat/room" class="menu-item">
        <MessageCircle size={20} />
        <span>{$t('ì±„íŒ…')}</span>
      </a>

      <!-- ì‚¬ìš©ì ëª©ë¡ -->
      <a href="/user/list" class="menu-item">
        <Users size={20} />
        <span>{$t('ì‚¬ìš©ìëª©ë¡')}</span>
      </a>

      <!-- í”„ë¡œí•„ -->
      <a href="/user/profile" class="menu-item">
        <User size={20} />
        <span>{$t('ë‚´í”„ë¡œí•„')}</span>
      </a>

      <!-- ê²Œì‹œíŒ -->
      <a href="/post/list" class="menu-item">
        <FileText size={20} />
        <span>{$t('ê²Œì‹œíŒ')}</span>
      </a>
    </nav>

    <!-- êµ¬ë¶„ì„  -->
    <div class="divider"></div>

    <!-- ì‹œì‘í•˜ê¸° ì„¹ì…˜ -->
    <div class="section">
      <h3 class="section-subtitle">{$t('ì‹œì‘í•˜ê¸°')}</h3>
      <div class="menu">
        {#if $user}
          <!-- ë¡œê·¸ì¸í•œ ì‚¬ìš©ì - í”„ë¡œí•„ ìˆ˜ì • ë§í¬ -->
          <a href="/user/profile" class="menu-item-small">
            <User size={16} />
            <span>{$t('íšŒì›ì •ë³´ìˆ˜ì •')}</span>
          </a>
        {:else}
          <!-- ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ì - ë¡œê·¸ì¸/íšŒì›ê°€ì… ë§í¬ -->
          <a href="/auth/login" class="menu-item-small">
            <LogIn size={16} />
            <span>{$t('ë¡œê·¸ì¸')}</span>
          </a>
          <a href="/auth/signup" class="menu-item-small">
            <User size={16} />
            <span>{$t('íšŒì›ê°€ì…')}</span>
          </a>
        {/if}
      </div>
    </div>

    <!-- êµ¬ë¶„ì„  -->
    <div class="divider"></div>

    <!-- ë§í¬ ì„¹ì…˜ -->
    <div class="menu">
      <!-- íšŒì› ëª©ë¡ -->
      <a href="/user/list" class="menu-item-small">
        <Users size={16} />
        <span>{$t('íšŒì›ëª©ë¡')}</span>
      </a>

      <!-- í”„ë¡œì íŠ¸ GitHub -->
      <a
        href="https://github.com/thruthesky/vibe"
        target="_blank"
        rel="noopener noreferrer"
        class="menu-item-small"
      >
        <svg
          class="icon"
          width="16"
          height="16"
          fill="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v 3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"
          />
        </svg>
        <span>{$t('í”„ë¡œì íŠ¸GitHub')}</span>
        <ExternalLink size={12} class="external-icon" />
      </a>

      <!-- í•œë°”ë³´ ì°¸ì—¬ ë‹¨í†¡ë°© -->
      <a
        href="https://open.kakao.com/o/gn2qMetf"
        target="_blank"
        rel="noopener noreferrer"
        class="menu-item-small"
      >
        <MessageCircle size={16} />
        <span>{$t('í•œë°”ë³´ì°¸ì—¬ë‹¨í†¡ë°©')}</span>
        <ExternalLink size={12} class="external-icon" />
      </a>

      <!-- ê°œë°œì¼ì§€ -->
      <a href="/dev/history" class="menu-item-small">
        <BookOpen size={16} />
        <span>{$t('ê°œë°œì¼ì§€')}</span>
      </a>
    </div>

    <!-- ì–¸ì–´ ì„¤ì • ì„¹ì…˜ -->
    <div class="section language-section">
      <h3 class="section-subtitle">{$t('ì–¸ì–´ì„¤ì •')}</h3>
      <div class="language-compact">
        <label class="language-label" for="language-select" aria-label={$t('ì–¸ì–´ì„¤ì •')}>ğŸŒ</label>
        <select
          id="language-select"
          class="language-select"
          value={$locale}
          on:change={(e) => setLocale(e.currentTarget.value)}
        >
          {#each LANGUAGE_OPTIONS as option}
            <option value={option.code}>
              {option.label}
            </option>
          {/each}
        </select>
      </div>
    </div>

    <!-- ë¹Œë“œ íƒ€ì„ìŠ¤íƒ¬í”„ -->
    <div class="build-info">
      <div class="build-row">
        <span>{$t('ë¹Œë“œë²„ì „')}</span>
        <span class="build-timestamp">
          {new Date().toLocaleString('ko-KR', {
            year: '2-digit',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            hour12: true
          })}
        </span>
      </div>
    </div>

    <!-- Copyleft ì •ë³´ -->
    <div class="copyleft">
      <p>
        {$t('ì¹´í”¼ë ˆí”„íŠ¸')}<br />
        {$t('AIì†Œê°œ')}
      </p>
    </div>
  </div>
</aside>

<style>
  /* ì‚¬ì´ë“œë°” */
  .sidebar {
    width: 16rem;
    border-right: 1px solid #e5e7eb;
    background-color: white;
    padding: 1rem;
    overflow-y: hidden;
    height: 100vh;
  }

  /* ì‚¬ì´ë“œë°” ì½˜í…ì¸  */
  .sidebar-content {
    position: sticky;
    top: 5rem;
  }

  /* ì„¹ì…˜ ì œëª© */
  .section-title {
    font-size: 1.125rem;
    font-weight: bold;
    margin-bottom: 1rem;
    color: #111827;
  }

  /* ì„¹ì…˜ ë¶€ì œëª© */
  .section-subtitle {
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: #6b7280;
  }

  /* ë©”ë‰´ */
  .menu {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  /* ë©”ë‰´ ì•„ì´í…œ */
  .menu-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem 0.75rem;
    border-radius: 0.5rem;
    color: #374151;
    text-decoration: none;
    transition: all 0.2s;
    cursor: pointer;
  }

  .menu-item:hover {
    background-color: #f3f4f6;
    color: #111827;
  }

  .menu-item.disabled {
    color: #9ca3af;
    cursor: not-allowed;
  }

  /* ì‘ì€ ë©”ë‰´ ì•„ì´í…œ */
  .menu-item-small {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem 0.75rem;
    border-radius: 0.5rem;
    color: #374151;
    text-decoration: none;
    transition: all 0.2s;
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
  }

  .menu-item-small:hover {
    background-color: #f3f4f6;
    color: #111827;
  }

  /* ì™¸ë¶€ ë§í¬ ì•„ì´ì½˜ */
  .external-icon {
    margin-left: auto;
  }

  /* ì•„ì´ì½˜ */
  .icon {
    flex-shrink: 0;
  }

  /* êµ¬ë¶„ì„  */
  .divider {
    height: 1px;
    background-color: #e5e7eb;
    margin: 1.5rem 0;
  }

  /* ì„¹ì…˜ */
  .section {
    margin-bottom: 1.5rem;
  }

  /* ì–¸ì–´ ì„¤ì • ì„¹ì…˜ */
  .language-section {
    margin-top: 1.5rem;
    padding-top: 1rem;
    border-top: 1px solid #e5e7eb;
  }

  .language-compact {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .language-label {
    font-size: 0.85rem;
    font-weight: 600;
    color: #374151;
    white-space: nowrap;
  }

  .language-select {
    flex: 1;
    padding: 0.45rem 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 0.5rem;
    background-color: #ffffff;
    color: #111827;
    font-size: 0.85rem;
    font-weight: 500;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L6 6L11 1' stroke='%236b7280' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.75rem center;
    background-size: 12px 8px;
    cursor: pointer;
  }

  .language-select:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
  }

  /* ë¹Œë“œ ì •ë³´ */
  .build-info {
    margin-top: 2rem;
    padding-top: 1rem;
    border-top: 1px solid #e5e7eb;
    font-size: 0.75rem;
    color: #6b7280;
  }

  .build-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .build-timestamp {
    font-family: 'Courier New', monospace;
  }

  /* Copyleft ì •ë³´ */
  .copyleft {
    margin-top: 1rem;
    text-align: center;
    font-size: 0.75rem;
    color: #6b7280;
  }

  .copyleft p {
    line-height: 1.5;
  }

  /* ë°˜ì‘í˜•: ëª¨ë°”ì¼ì—ì„œëŠ” ìˆ¨ê¹€ */
  @media (max-width: 768px) {
    .sidebar {
      display: none;
    }
  }
</style>
